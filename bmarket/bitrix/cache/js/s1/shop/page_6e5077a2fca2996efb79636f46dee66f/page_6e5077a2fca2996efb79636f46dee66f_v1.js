
; /* Start:"a:4:{s:4:"full";s:92:"/local/templates/shop/components/bitrix/catalog.element/detail/script.min.js?159681840358488";s:6:"source";s:72:"/local/templates/shop/components/bitrix/catalog.element/detail/script.js";s:3:"min";s:76:"/local/templates/shop/components/bitrix/catalog.element/detail/script.min.js";s:3:"map";s:76:"/local/templates/shop/components/bitrix/catalog.element/detail/script.map.js";}"*/
(function(t){"use strict";if(t.JCCatalogElement)return;var i=function(t){i.superclass.constructor.apply(this,arguments);this.buttonNode=BX.create("SPAN",{props:{className:"btn btn-default btn-buy btn-sm",id:this.id},style:typeof t.style==="object"?t.style:{},text:t.text,events:this.contextEvents});if(BX.browser.IsIE()){this.buttonNode.setAttribute("hideFocus","hidefocus")}};BX.extend(i,BX.PopupWindowButton);t.JCCatalogElement=function(t){this.productType=0;this.config={useCatalog:true,showQuantity:true,showPrice:true,showAbsent:true,showOldPrice:false,showPercent:false,showSkuProps:false,showOfferGroup:false,useCompare:false,useStickers:false,useSubscribe:false,usePopup:false,useMagnifier:false,usePriceRanges:false,basketAction:["BUY"],showClosePopup:false,templateTheme:"",showSlider:false,sliderInterval:5e3,useEnhancedEcommerce:false,dataLayerName:"dataLayer",brandProperty:false,alt:"",title:"",magnifierZoomPercent:200};this.checkQuantity=false;this.maxQuantity=0;this.minQuantity=0;this.stepQuantity=1;this.isDblQuantity=false;this.canBuy=true;this.isGift=false;this.canSubscription=true;this.currentIsSet=false;this.updateViewedCount=false;this.currentPriceMode="";this.currentPrices=[];this.currentPriceSelected=0;this.currentQuantityRanges=[];this.currentQuantityRangeSelected=0;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.visual={};this.basketMode="";this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,startQuantity:1,isDblQuantity:false,canBuy:true,canSubscription:true,name:"",pict:{},id:0,addUrl:"",buyUrl:"",slider:{},sliderCount:0,useSlider:false,sliderPict:[]};this.mess={};this.basketData={useProps:false,emptyProps:false,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""};this.compareData={compareUrl:"",compareDeleteUrl:"",comparePath:""};this.defaultPict={preview:null,detail:null};this.offers=[];this.offerNum=0;this.treeProps=[];this.selectedValues={};this.mouseTimer=null;this.isTouchDevice=BX.hasClass(document.documentElement,"bx-touch");this.touch=null;this.slider={interval:null,progress:null,paused:null,controls:[]};this.quantityDelay=null;this.quantityTimer=null;this.obProduct=null;this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obPrice={price:null,full:null,discount:null,percent:null,total:null};this.obTree=null;this.obPriceRanges=null;this.obBuyBtn=null;this.obAddToBasketBtn=null;this.obBasketActions=null;this.obNotAvail=null;this.obSubscribe=null;this.obSkuProps=null;this.obMainSkuProps=null;this.obBigSlider=null;this.obMeasure=null;this.obQuantityLimit={all:null,value:null};this.obCompare=null;this.obTabsPanel=null;this.node={};this.smallCardNodes={};this.magnify={enabled:false,obBigImg:null,obBigSlider:null,height:0,width:0,timer:0};this.currentImg={id:0,src:"",width:0,height:0};this.viewedCounter={path:"/bitrix/components/bitrix/catalog.element/ajax.php",params:{AJAX:"Y",SITE_ID:"",PRODUCT_ID:0,PARENT_ID:0}};this.obPopupWin=null;this.basketUrl="";this.basketParams={};this.errorCode=0;if(typeof t==="object"){this.params=t;this.initConfig();if(this.params.MESS){this.mess=this.params.MESS}switch(this.productType){case 0:case 1:case 2:this.initProductData();break;case 3:this.initOffersData();break;default:this.errorCode=-1}this.initBasketData();this.initCompareData()}if(this.errorCode===0){BX.ready(BX.delegate(this.init,this))}this.params={};BX.addCustomEvent("onSaleProductIsGift",BX.delegate(this.onSaleProductIsGift,this));BX.addCustomEvent("onSaleProductIsNotGift",BX.delegate(this.onSaleProductIsNotGift,this))};t.JCCatalogElement.prototype={getEntity:function(t,i,e){if(!t||!i)return null;e=e||"";return t.querySelector(e+'[data-entity="'+i+'"]')},getEntities:function(t,i,e){if(!t||!i)return{length:0};e=e||"";return t.querySelectorAll(e+'[data-entity="'+i+'"]')},onSaleProductIsGift:function(t,i){if(i&&this.offers&&this.offers[this.offerNum].ID==i){this.setGift()}},onSaleProductIsNotGift:function(t,i){if(i&&this.offers&&this.offers[this.offerNum].ID==i){this.restoreSticker();this.isGift=false;this.setPrice()}},reloadGiftInfo:function(){if(this.productType===3){this.checkQuantity=true;this.maxQuantity=1;this.setPrice();this.redrawSticker({text:BX.message("PRODUCT_GIFT_LABEL")})}},setGift:function(){if(this.productType===3){this.isGift=true}if(this.productType===1||this.productType===2){this.isGift=true}if(this.productType===0){this.isGift=false}this.reloadGiftInfo()},setOffer:function(t){this.offerNum=parseInt(t);this.setCurrent()},init:function(){var i=0,e=0,s=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1}this.obBigSlider=BX(this.visual.BIG_SLIDER_ID);this.node.imageContainer=this.getEntity(this.obProduct,"images-container");this.node.imageSliderBlock=this.getEntity(this.obProduct,"images-slider-block");this.node.sliderProgressBar=this.getEntity(this.obProduct,"slider-progress-bar");this.node.sliderControlLeft=this.getEntity(this.obBigSlider,"slider-control-left");this.node.sliderControlRight=this.getEntity(this.obBigSlider,"slider-control-right");if(!this.obBigSlider||!this.node.imageContainer||!this.node.imageContainer){this.errorCode=-2}if(this.config.showPrice){this.obPrice.price=BX(this.visual.PRICE_ID);if(!this.obPrice.price&&this.config.useCatalog){this.errorCode=-16}else{this.obPrice.total=BX(this.visual.PRICE_TOTAL);if(this.config.showOldPrice){this.obPrice.full=BX(this.visual.OLD_PRICE_ID);this.obPrice.discount=BX(this.visual.DISCOUNT_PRICE_ID);if(!this.obPrice.full||!this.obPrice.discount){this.config.showOldPrice=false}}if(this.config.showPercent){this.obPrice.percent=BX(this.visual.DISCOUNT_PERCENT_ID);if(!this.obPrice.percent){this.config.showPercent=false}}}this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID);if(this.obBasketActions){if(BX.util.in_array("BUY",this.config.basketAction)){this.obBuyBtn=BX(this.visual.BUY_LINK)}if(BX.util.in_array("ADD",this.config.basketAction)){this.obAddToBasketBtn=BX(this.visual.ADD_BASKET_LINK)}}this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS)}if(this.config.showQuantity){this.obQuantity=BX(this.visual.QUANTITY_ID);this.node.quantity=this.getEntity(this.obProduct,"quantity-block");if(this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)}if(this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID)}}if(this.productType===3){if(this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256}}if(this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE)}if(this.visual.QUANTITY_LIMIT&&this.config.showMaxQuantity!=="N"){this.obQuantityLimit.all=BX(this.visual.QUANTITY_LIMIT);if(this.obQuantityLimit.all){this.obQuantityLimit.value=this.getEntity(this.obQuantityLimit.all,"quantity-limit-value");if(!this.obQuantityLimit.value){this.obQuantityLimit.all=null}}}if(this.config.usePriceRanges){this.obPriceRanges=this.getEntity(this.obProduct,"price-ranges-block")}}if(this.config.showSkuProps){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV);this.obMainSkuProps=BX(this.visual.DISPLAY_MAIN_PROP_DIV)}if(this.config.useCompare){this.obCompare=BX(this.visual.COMPARE_LINK)}if(this.config.useSubscribe){this.obSubscribe=BX(this.visual.SUBSCRIBE_LINK)}this.obTabs=BX(this.visual.TABS_ID);this.obTabContainers=BX(this.visual.TAB_CONTAINERS_ID);this.obTabsPanel=BX(this.visual.TABS_PANEL_ID);this.smallCardNodes.panel=BX(this.visual.SMALL_CARD_PANEL_ID);if(this.smallCardNodes.panel){this.smallCardNodes.picture=this.getEntity(this.smallCardNodes.panel,"panel-picture");this.smallCardNodes.title=this.getEntity(this.smallCardNodes.panel,"panel-title");this.smallCardNodes.price=this.getEntity(this.smallCardNodes.panel,"panel-price");this.smallCardNodes.sku=this.getEntity(this.smallCardNodes.panel,"panel-sku-container");this.smallCardNodes.oldPrice=this.getEntity(this.smallCardNodes.panel,"panel-old-price");this.smallCardNodes.buyButton=this.getEntity(this.smallCardNodes.panel,"panel-buy-button");this.smallCardNodes.addButton=this.getEntity(this.smallCardNodes.panel,"panel-add-button");this.smallCardNodes.notAvailableButton=this.getEntity(this.smallCardNodes.panel,"panel-not-available-button");this.smallCardNodes.aligner=this.getEntity(this.obProduct,"main-button-container")}this.initPopup();this.initTabs();if(this.smallCardNodes.panel){this.smallCardNodes.picture&&BX.bind(this.smallCardNodes.picture.parentNode,"click",BX.proxy(this.scrollToProduct,this));this.smallCardNodes.title&&BX.bind(this.smallCardNodes.title,"click",BX.proxy(this.scrollToProduct,this));this.smallCardNodes.sku&&BX.bind(this.smallCardNodes.sku,"click",BX.proxy(this.scrollToProduct,this))}if(this.obTabsPanel||this.smallCardNodes.panel){this.checkTopPanels();BX.bind(t,"scroll",BX.proxy(this.checkTopPanels,this))}if(this.errorCode===0){if(this.config.showSlider&&!this.isTouchDevice){BX.bind(this.obBigSlider,"mouseenter",BX.proxy(this.stopSlider,this));BX.bind(this.obBigSlider,"mouseleave",BX.proxy(this.cycleSlider,this))}if(this.isTouchDevice){BX.bind(this.node.imageContainer,"touchstart",BX.proxy(this.touchStartEvent,this));BX.bind(this.node.imageContainer,"touchend",BX.proxy(this.touchEndEvent,this));BX.bind(this.node.imageContainer,"touchcancel",BX.proxy(this.touchEndEvent,this))}BX.bind(this.node.sliderControlLeft,"click",BX.proxy(this.slidePrev,this));BX.bind(this.node.sliderControlRight,"click",BX.proxy(this.slideNext,this));if(this.config.showQuantity){var a=this.isTouchDevice?"touchstart":"mousedown";var r=this.isTouchDevice?"touchend":"mouseup";if(this.obQuantityUp){BX.bind(this.obQuantityUp,a,BX.proxy(this.startQuantityInterval,this));BX.bind(this.obQuantityUp,r,BX.proxy(this.clearQuantityInterval,this));BX.bind(this.obQuantityUp,"mouseout",BX.proxy(this.clearQuantityInterval,this));BX.bind(this.obQuantityUp,"click",BX.delegate(this.quantityUp,this))}if(this.obQuantityDown){BX.bind(this.obQuantityDown,a,BX.proxy(this.startQuantityInterval,this));BX.bind(this.obQuantityDown,r,BX.proxy(this.clearQuantityInterval,this));BX.bind(this.obQuantityDown,"mouseout",BX.proxy(this.clearQuantityInterval,this));BX.bind(this.obQuantityDown,"click",BX.delegate(this.quantityDown,this))}if(this.obQuantity){BX.bind(this.obQuantity,"change",BX.delegate(this.quantityChange,this))}}switch(this.productType){case 0:case 1:case 2:if(this.product.useSlider){this.product.slider={ID:this.visual.SLIDER_CONT_ID,CONT:BX(this.visual.SLIDER_CONT_ID),COUNT:this.product.sliderCount};this.product.slider.ITEMS=this.getEntities(this.product.slider.CONT,"slider-control");for(e=0;e<this.product.slider.ITEMS.length;e++){BX.bind(this.product.slider.ITEMS[e],"mouseenter",BX.delegate(this.onSliderControlHover,this));BX.bind(this.product.slider.ITEMS[e],"mouseleave",BX.delegate(this.onSliderControlLeave,this));BX.bind(this.product.slider.ITEMS[e],"click",BX.delegate(this.selectSliderImg,this))}this.setCurrentImg(this.product.sliderPict[0],true,true);this.checkSliderControls(this.product.sliderCount);if(this.product.slider.ITEMS.length>1){this.initSlider()}}this.checkQuantityControls();this.fixFontCheck();this.setAnalyticsDataLayer("showDetail");break;case 3:s=this.obTree.querySelectorAll("li");for(i=0;i<s.length;i++){BX.bind(s[i],"click",BX.delegate(this.selectOfferProp,this))}for(i=0;i<this.offers.length;i++){this.offers[i].SLIDER_COUNT=parseInt(this.offers[i].SLIDER_COUNT,10)||0;if(this.offers[i].SLIDER_COUNT===0){this.slider.controls[i]={ID:"",COUNT:this.offers[i].SLIDER_COUNT,ITEMS:[]}}else{for(e=0;e<this.offers[i].SLIDER.length;e++){this.offers[i].SLIDER[e].WIDTH=parseInt(this.offers[i].SLIDER[e].WIDTH,10);this.offers[i].SLIDER[e].HEIGHT=parseInt(this.offers[i].SLIDER[e].HEIGHT,10)}this.slider.controls[i]={ID:this.visual.SLIDER_CONT_OF_ID+this.offers[i].ID,OFFER_ID:this.offers[i].ID,CONT:BX(this.visual.SLIDER_CONT_OF_ID+this.offers[i].ID),COUNT:this.offers[i].SLIDER_COUNT};this.slider.controls[i].ITEMS=this.getEntities(this.slider.controls[i].CONT,"slider-control");for(e=0;e<this.slider.controls[i].ITEMS.length;e++){BX.bind(this.slider.controls[i].ITEMS[e],"mouseenter",BX.delegate(this.onSliderControlHover,this));BX.bind(this.slider.controls[i].ITEMS[e],"mouseleave",BX.delegate(this.onSliderControlLeave,this));BX.bind(this.slider.controls[i].ITEMS[e],"click",BX.delegate(this.selectSliderImg,this))}}}this.setCurrent();break}this.obBuyBtn&&BX.bind(this.obBuyBtn,"click",BX.proxy(this.buyBasket,this));this.smallCardNodes.buyButton&&BX.bind(this.smallCardNodes.buyButton,"click",BX.proxy(this.buyBasket,this));this.obAddToBasketBtn&&BX.bind(this.obAddToBasketBtn,"click",BX.proxy(this.add2Basket,this));this.smallCardNodes.addButton&&BX.bind(this.smallCardNodes.addButton,"click",BX.proxy(this.add2Basket,this));if(this.obCompare){BX.bind(this.obCompare,"click",BX.proxy(this.compare,this));BX.addCustomEvent("onCatalogDeleteCompare",BX.proxy(this.checkDeletedCompare,this))}}},initConfig:function(){if(this.params.PRODUCT_TYPE){this.productType=parseInt(this.params.PRODUCT_TYPE,10)}if(this.params.CONFIG.USE_CATALOG!=="undefined"&&BX.type.isBoolean(this.params.CONFIG.USE_CATALOG)){this.config.useCatalog=this.params.CONFIG.USE_CATALOG}this.config.showQuantity=this.params.CONFIG.SHOW_QUANTITY;this.config.showPrice=this.params.CONFIG.SHOW_PRICE;this.config.showPercent=this.params.CONFIG.SHOW_DISCOUNT_PERCENT;this.config.showOldPrice=this.params.CONFIG.SHOW_OLD_PRICE;this.config.showSkuProps=this.params.CONFIG.SHOW_SKU_PROPS;this.config.showOfferGroup=this.params.CONFIG.OFFER_GROUP;this.config.useCompare=this.params.CONFIG.DISPLAY_COMPARE;this.config.useStickers=this.params.CONFIG.USE_STICKERS;this.config.useSubscribe=this.params.CONFIG.USE_SUBSCRIBE;this.config.showMaxQuantity=this.params.CONFIG.SHOW_MAX_QUANTITY;this.config.relativeQuantityFactor=parseInt(this.params.CONFIG.RELATIVE_QUANTITY_FACTOR);this.config.usePriceRanges=this.params.CONFIG.USE_PRICE_COUNT;if(this.params.CONFIG.MAIN_PICTURE_MODE){this.config.usePopup=BX.util.in_array("POPUP",this.params.CONFIG.MAIN_PICTURE_MODE);this.config.useMagnifier=BX.util.in_array("MAGNIFIER",this.params.CONFIG.MAIN_PICTURE_MODE)}if(this.params.CONFIG.ADD_TO_BASKET_ACTION){this.config.basketAction=this.params.CONFIG.ADD_TO_BASKET_ACTION}this.config.showClosePopup=this.params.CONFIG.SHOW_CLOSE_POPUP;this.config.templateTheme=this.params.CONFIG.TEMPLATE_THEME||"";this.config.showSlider=this.params.CONFIG.SHOW_SLIDER==="Y";if(this.config.showSlider&&!this.isTouchDevice){this.config.sliderInterval=parseInt(this.params.CONFIG.SLIDER_INTERVAL)||5e3}else{this.config.sliderInterval=false}this.config.useEnhancedEcommerce=this.params.CONFIG.USE_ENHANCED_ECOMMERCE==="Y";this.config.dataLayerName=this.params.CONFIG.DATA_LAYER_NAME;this.config.brandProperty=this.params.CONFIG.BRAND_PROPERTY;this.config.alt=this.params.CONFIG.ALT||"";this.config.title=this.params.CONFIG.TITLE||"";this.config.magnifierZoomPercent=parseInt(this.params.CONFIG.MAGNIFIER_ZOOM_PERCENT)||200;if(!this.params.VISUAL||typeof this.params.VISUAL!=="object"||!this.params.VISUAL.ID){this.errorCode=-1;return}this.visual=this.params.VISUAL},initProductData:function(){var t=0;if(this.params.PRODUCT&&typeof this.params.PRODUCT==="object"){if(this.config.showPrice){this.currentPriceMode=this.params.PRODUCT.ITEM_PRICE_MODE;this.currentPrices=this.params.PRODUCT.ITEM_PRICES;this.currentPriceSelected=this.params.PRODUCT.ITEM_PRICE_SELECTED;this.currentQuantityRanges=this.params.PRODUCT.ITEM_QUANTITY_RANGES;this.currentQuantityRangeSelected=this.params.PRODUCT.ITEM_QUANTITY_RANGE_SELECTED}if(this.config.showQuantity){this.product.checkQuantity=this.params.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=this.params.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=this.product.isDblQuantity?parseFloat(this.params.PRODUCT.MAX_QUANTITY):parseInt(this.params.PRODUCT.MAX_QUANTITY,10)}this.product.stepQuantity=this.product.isDblQuantity?parseFloat(this.params.PRODUCT.STEP_QUANTITY):parseInt(this.params.PRODUCT.STEP_QUANTITY,10);this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.stepQuantity=this.product.stepQuantity;this.maxQuantity=this.product.maxQuantity;this.minQuantity=this.currentPriceMode==="Q"?parseFloat(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor}}this.product.canBuy=this.params.PRODUCT.CAN_BUY;this.canSubscription=this.product.canSubscription=this.params.PRODUCT.SUBSCRIPTION;this.product.name=this.params.PRODUCT.NAME;this.product.pict=this.params.PRODUCT.PICT;this.product.id=this.params.PRODUCT.ID;this.product.category=this.params.PRODUCT.CATEGORY;if(this.params.PRODUCT.ADD_URL){this.product.addUrl=this.params.PRODUCT.ADD_URL}if(this.params.PRODUCT.BUY_URL){this.product.buyUrl=this.params.PRODUCT.BUY_URL}if(this.params.PRODUCT.SLIDER_COUNT){this.product.sliderCount=parseInt(this.params.PRODUCT.SLIDER_COUNT,10)||0;if(this.product.sliderCount>0&&this.params.PRODUCT.SLIDER.length){for(t=0;t<this.params.PRODUCT.SLIDER.length;t++){this.product.useSlider=true;this.params.PRODUCT.SLIDER[t].WIDTH=parseInt(this.params.PRODUCT.SLIDER[t].WIDTH,10);this.params.PRODUCT.SLIDER[t].HEIGHT=parseInt(this.params.PRODUCT.SLIDER[t].HEIGHT,10)}this.product.sliderPict=this.params.PRODUCT.SLIDER;this.setCurrentImg(this.product.sliderPict[0],false)}}this.currentIsSet=true}else{this.errorCode=-1}},initOffersData:function(){if(this.params.OFFERS&&BX.type.isArray(this.params.OFFERS)){this.offers=this.params.OFFERS;this.offerNum=0;if(this.params.OFFER_SELECTED){this.offerNum=parseInt(this.params.OFFER_SELECTED,10)||0}if(this.params.TREE_PROPS){this.treeProps=this.params.TREE_PROPS}if(this.params.DEFAULT_PICTURE){this.defaultPict.preview=this.params.DEFAULT_PICTURE.PREVIEW_PICTURE;this.defaultPict.detail=this.params.DEFAULT_PICTURE.DETAIL_PICTURE}if(this.params.PRODUCT&&typeof this.params.PRODUCT==="object"){this.product.id=parseInt(this.params.PRODUCT.ID,10);this.product.name=this.params.PRODUCT.NAME;this.product.category=this.params.PRODUCT.CATEGORY}}else{this.errorCode=-1}},initBasketData:function(){if(this.params.BASKET&&typeof this.params.BASKET==="object"){if(this.productType===1||this.productType===2){this.basketData.useProps=this.params.BASKET.ADD_PROPS;this.basketData.emptyProps=this.params.BASKET.EMPTY_PROPS}if(this.params.BASKET.QUANTITY){this.basketData.quantity=this.params.BASKET.QUANTITY}if(this.params.BASKET.PROPS){this.basketData.props=this.params.BASKET.PROPS}if(this.params.BASKET.BASKET_URL){this.basketData.basketUrl=this.params.BASKET.BASKET_URL}if(this.productType===3){if(this.params.BASKET.SKU_PROPS){this.basketData.sku_props=this.params.BASKET.SKU_PROPS}}if(this.params.BASKET.ADD_URL_TEMPLATE){this.basketData.add_url=this.params.BASKET.ADD_URL_TEMPLATE}if(this.params.BASKET.BUY_URL_TEMPLATE){this.basketData.buy_url=this.params.BASKET.BUY_URL_TEMPLATE}if(this.basketData.add_url===""&&this.basketData.buy_url===""){this.errorCode=-1024}}},initCompareData:function(){if(this.config.useCompare){if(this.params.COMPARE&&typeof this.params.COMPARE==="object"){if(this.params.COMPARE.COMPARE_PATH){this.compareData.comparePath=this.params.COMPARE.COMPARE_PATH}if(this.params.COMPARE.COMPARE_URL_TEMPLATE){this.compareData.compareUrl=this.params.COMPARE.COMPARE_URL_TEMPLATE}else{this.config.useCompare=false}if(this.params.COMPARE.COMPARE_DELETE_URL_TEMPLATE){this.compareData.compareDeleteUrl=this.params.COMPARE.COMPARE_DELETE_URL_TEMPLATE}else{this.config.useCompare=false}}else{this.config.useCompare=false}}},initSlider:function(){if(this.node.sliderProgressBar){if(this.slider.progress){this.resetProgress()}else{this.slider.progress=new BX.easing({transition:BX.easing.transitions.linear,step:BX.delegate(function(t){this.node.sliderProgressBar.style.width=t.width/10+"%"},this)})}}this.cycleSlider()},setAnalyticsDataLayer:function(i){if(!this.config.useEnhancedEcommerce||!this.config.dataLayerName)return;var e={},s={},a=[],r,o,n,h,l,u;switch(this.productType){case 0:case 1:case 2:e={id:this.product.id,name:this.product.name,price:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,category:this.product.category,brand:BX.type.isArray(this.config.brandProperty)?this.config.brandProperty.join("/"):this.config.brandProperty};break;case 3:for(r in this.offers[this.offerNum].TREE){if(this.offers[this.offerNum].TREE.hasOwnProperty(r)){h=r.substring(5);l=this.offers[this.offerNum].TREE[r];for(o in this.treeProps){if(this.treeProps.hasOwnProperty(o)&&this.treeProps[o].ID==h){for(n in this.treeProps[o].VALUES){u=this.treeProps[o].VALUES[n];if(u.ID==l){a.push(u.NAME);break}}}}}}e={id:this.offers[this.offerNum].ID,name:this.offers[this.offerNum].NAME,price:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].PRICE,category:this.product.category,brand:BX.type.isArray(this.config.brandProperty)?this.config.brandProperty.join("/"):this.config.brandProperty,variant:a.join("/")};break}switch(i){case"showDetail":s={event:"showDetail",ecommerce:{currencyCode:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].CURRENCY||"",detail:{products:[{name:e.name||"",id:e.id||"",price:e.price||0,brand:e.brand||"",category:e.category||"",variant:e.variant||""}]}}};break;case"addToCart":s={event:"addToCart",ecommerce:{currencyCode:this.currentPrices[this.currentPriceSelected]&&this.currentPrices[this.currentPriceSelected].CURRENCY||"",add:{products:[{name:e.name||"",id:e.id||"",price:e.price||0,brand:e.brand||"",category:e.category||"",variant:e.variant||"",quantity:this.config.showQuantity&&this.obQuantity?this.obQuantity.value:1}]}}};break}t[this.config.dataLayerName]=t[this.config.dataLayerName]||[];t[this.config.dataLayerName].push(s)},initTabs:function(){var t=this.getEntities(this.obTabs,"tab"),i=this.getEntities(this.obTabsPanel,"tab");var e,s,a=false;if(t.length!==i.length)return;for(var r in t){if(t.hasOwnProperty(r)&&BX.type.isDomNode(t[r])){e=t[r].getAttribute("data-value");if(e){s=this.obTabContainers.querySelector('[data-value="'+e+'"]');if(BX.type.isDomNode(s)){BX.bind(t[r],"click",BX.proxy(this.changeTab,this));BX.bind(i[r],"click",BX.proxy(this.changeTab,this));if(!a){BX.addClass(t[r],"active");BX.addClass(i[r],"active");BX.show(s);a=true}else{BX.removeClass(t[r],"active");BX.removeClass(i[r],"active");BX.hide(s)}}}}}},checkTouch:function(t){if(!t||!t.changedTouches)return false;return t.changedTouches[0].identifier===this.touch.identifier},touchStartEvent:function(t){if(t.touches.length!=1)return;this.touch=t.changedTouches[0]},touchEndEvent:function(t){if(!this.checkTouch(t))return;var i=this.touch.pageX-t.changedTouches[0].pageX,e=this.touch.pageY-t.changedTouches[0].pageY;if(Math.abs(i)>=Math.abs(e)+10){if(i>0){this.slideNext()}if(i<0){this.slidePrev()}}},cycleSlider:function(t){t||(this.slider.paused=false);this.slider.interval&&clearInterval(this.slider.interval);if(this.config.sliderInterval&&!this.slider.paused){if(this.slider.progress){this.slider.progress.stop();var i=parseInt(this.node.sliderProgressBar.style.width);this.slider.progress.options.duration=this.config.sliderInterval*(100-i)/100;this.slider.progress.options.start={width:i*10};this.slider.progress.options.finish={width:1e3};this.slider.progress.options.complete=BX.delegate(function(){this.slider.interval=true;this.slideNext()},this);this.slider.progress.animate()}else{this.slider.interval=setInterval(BX.proxy(this.slideNext,this),this.config.sliderInterval)}}},stopSlider:function(t){t||(this.slider.paused=true);this.slider.interval&&(this.slider.interval=clearInterval(this.slider.interval));if(this.slider.progress){this.slider.progress.stop();var i=parseInt(this.node.sliderProgressBar.style.width);this.slider.progress.options.duration=this.config.sliderInterval*i/200;this.slider.progress.options.start={width:i*10};this.slider.progress.options.finish={width:0};this.slider.progress.options.complete=null;this.slider.progress.animate()}},resetProgress:function(){this.slider.progress&&this.slider.progress.stop();this.node.sliderProgressBar.style.width=0},slideNext:function(){return this.slide("next")},slidePrev:function(){return this.slide("prev")},slide:function(t){if(!this.product.slider||!this.product.slider.CONT)return;var i=this.getEntity(this.product.slider.CONT,"slider-control",".active"),e=this.getItemForDirection(t,i);BX.removeClass(i,"active");this.selectSliderImg(e);this.slider.interval&&this.cycleSlider()},getItemForDirection:function(t,i){var e=this.getItemIndex(i),s=t==="prev"?-1:1,a=(e+s)%this.product.slider.COUNT;return this.eq(this.product.slider.ITEMS,a)},getItemIndex:function(t){return BX.util.array_values(this.product.slider.ITEMS).indexOf(t)},eq:function(t,i){var e=t.length,s=+i+(i<0?e:0);return s>=0&&s<e?t[s]:{}},scrollToProduct:function(){var i=BX.GetWindowScrollPos().scrollTop,e=BX.pos(this.obProduct).top-30;if(i>e){new BX.easing({duration:500,start:{scroll:i},finish:{scroll:e},transition:BX.easing.makeEaseOut(BX.easing.transitions.quint),step:BX.delegate(function(i){t.scrollTo(0,i.scroll)},this)}).animate()}},checkTopPanels:function(){var t=BX.GetWindowScrollPos().scrollTop,i;if(this.smallCardNodes.panel){i=BX.pos(this.smallCardNodes.aligner).bottom-50;if(t>i){BX.addClass(this.smallCardNodes.panel,"active")}else if(BX.hasClass(this.smallCardNodes.panel,"active")){BX.removeClass(this.smallCardNodes.panel,"active")}}if(this.obTabsPanel){i=BX.pos(this.obTabs).top;if(t+73>i){BX.addClass(this.obTabsPanel,"active")}else if(BX.hasClass(this.obTabsPanel,"active")){BX.removeClass(this.obTabsPanel,"active")}}},changeTab:function(i){BX.PreventDefault(i);var e=BX.proxy_context&&BX.proxy_context.getAttribute("data-value"),s,a,r;if(!BX.hasClass(BX.proxy_context,"active")&&e){s=this.getEntities(this.obTabContainers,"tab-container");for(var o in s){if(s.hasOwnProperty(o)&&BX.type.isDomNode(s[o])){if(s[o].getAttribute("data-value")===e){BX.show(s[o])}else{BX.hide(s[o])}}}a=this.getEntities(this.obTabs,"tab");r=this.getEntities(this.obTabsPanel,"tab");for(o in a){if(a.hasOwnProperty(o)&&BX.type.isDomNode(a[o])){if(a[o].getAttribute("data-value")===e){BX.addClass(a[o],"active");BX.addClass(r[o],"active")}else{BX.removeClass(a[o],"active");BX.removeClass(r[o],"active")}}}}var n=BX.GetWindowScrollPos().scrollTop,h=BX.pos(this.obTabContainers).top;if(n+150>h){new BX.easing({duration:500,start:{scroll:n},finish:{scroll:h-150},transition:BX.easing.makeEaseOut(BX.easing.transitions.quint),step:BX.delegate(function(i){t.scrollTo(0,i.scroll)},this)}).animate()}},initPopup:function(){if(this.config.usePopup){this.node.imageContainer.style.cursor="zoom-in";BX.bind(this.node.imageContainer,"click",BX.delegate(this.toggleMainPictPopup,this));BX.bind(document,"keyup",BX.proxy(this.closeByEscape,this));BX.bind(this.getEntity(this.obBigSlider,"close-popup"),"click",BX.proxy(this.hideMainPictPopup,this))}},checkSliderControls:function(t){var i=t>1?"":"none";this.node.sliderControlLeft&&(this.node.sliderControlLeft.style.display=i);this.node.sliderControlRight&&(this.node.sliderControlRight.style.display=i)},setCurrentImg:function(t,i,e){var s,a;this.currentImg.id=t.ID;this.currentImg.src=t.SRC;this.currentImg.width=t.WIDTH;this.currentImg.height=t.HEIGHT;if(i&&this.node.imageContainer){s=this.getEntities(this.node.imageContainer,"image");a=s.length;while(a--){if(s[a].getAttribute("data-id")==t.ID){if(!BX.hasClass(s[a],"active")){this.node.sliderProgressBar&&this.resetProgress()}BX.addClass(s[a],"active")}else if(BX.hasClass(s[a],"active")){BX.removeClass(s[a],"active")}}}if(e&&this.smallCardNodes.picture){this.smallCardNodes.picture.setAttribute("src",this.currentImg.src)}if(this.config.useMagnifier&&!this.isTouchDevice){this.setMagnifierParams();if(i){this.disableMagnifier(true)}}},setMagnifierParams:function(){var t=this.getEntities(this.node.imageContainer,"image"),i=t.length,e;while(i--){e=t[i].querySelector("img");e.setAttribute("data-title",e.getAttribute("title")||"");e.removeAttribute("title");if(t[i].getAttribute("data-id")==this.currentImg.id){BX.unbind(this.currentImg.node,"mouseover",BX.proxy(this.enableMagnifier,this));this.currentImg.node=e;this.currentImg.node.style.backgroundImage="url('"+this.currentImg.src+"')";this.currentImg.node.style.backgroundSize="100% auto";BX.bind(this.currentImg.node,"mouseover",BX.proxy(this.enableMagnifier,this))}}},enableMagnifier:function(){BX.bind(document,"mousemove",BX.proxy(this.moveMagnifierArea,this))},disableMagnifier:function(t){if(!this.magnify.enabled)return;clearTimeout(this.magnify.timer);BX.removeClass(this.obBigSlider,"magnified");this.magnify.enabled=false;this.currentImg.node.style.backgroundSize="100% auto";if(t){this.currentImg.node.style.height=this.magnify.height+"px";this.currentImg.node.style.width=this.magnify.width+"px";this.magnify.timer=setTimeout(BX.delegate(function(){this.currentImg.node.src=this.currentImg.src;this.currentImg.node.style.height="";this.currentImg.node.style.width=""},this),250)}else{this.currentImg.node.src=this.currentImg.src;this.currentImg.node.style.height="";this.currentImg.node.style.width=""}BX.unbind(document,"mousemove",BX.proxy(this.moveMagnifierArea,this))},moveMagnifierArea:function(t){var i=BX.pos(this.currentImg.node),e=this.inRect(t,i);if(this.inBound(i,e)){var s=e.X/this.currentImg.node.width*100,a=e.Y/this.currentImg.node.height*100,r,o,n,h,l;this.currentImg.node.style.backgroundPosition=s+"% "+a+"%";if(!this.magnify.enabled){clearTimeout(this.magnify.timer);BX.addClass(this.obBigSlider,"magnified");this.currentImg.node.style.height=(this.magnify.height=this.currentImg.node.clientHeight)+"px";this.currentImg.node.style.width=(this.magnify.width=this.currentImg.node.offsetWidth)+"px";r=this.currentImg.width/this.currentImg.height;o=this.obBigSlider.offsetWidth;if(o>this.currentImg.width&&!BX.hasClass(this.obBigSlider,"popup")){n=o;h=n/r;l=100}else{n=this.currentImg.width;h=this.currentImg.height;l=this.config.magnifierZoomPercent>100?this.config.magnifierZoomPercent:100}this.currentImg.node.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQI12P4zwAAAgEBAKrChTYAAAAASUVORK5CYII=";this.currentImg.node.style.backgroundSize=l+"% auto";this.magnify.timer=setTimeout(BX.delegate(function(){this.currentImg.node.style.height=h+"px";this.currentImg.node.style.width=n+"px"},this),10)}this.magnify.enabled=true}else{this.disableMagnifier(true)}},inBound:function(t,i){return i.Y>=0&&t.height>=i.Y&&(i.X>=0&&t.width>=i.X)},inRect:function(t,i){var e=BX.GetWindowSize(),s={X:0,Y:0,globalX:0,globalY:0};s.globalX=t.clientX+e.scrollLeft;if(t.offsetX&&t.offsetX<0){s.globalX-=t.offsetX}s.X=s.globalX-i.left;s.globalY=t.clientY+e.scrollTop;if(t.offsetY&&t.offsetY<0){s.globalY-=t.offsetY}s.Y=s.globalY-i.top;return s},setProductMainPict:function(t){var i=-1,e=0,s=0,a="";if(this.product.sliderCount){for(s=0;s<this.product.sliderPict.length;s++){if(t===this.product.sliderPict[s].ID){i=s;break}}if(i>-1){if(this.product.sliderPict[i]){this.setCurrentImg(this.product.sliderPict[i],true)}for(e=0;e<this.product.slider.ITEMS.length;e++){a=this.product.slider.ITEMS[e].getAttribute("data-value");if(a===t){BX.addClass(this.product.slider.ITEMS[e],"active")}else if(BX.hasClass(this.product.slider.ITEMS[e],"active")){BX.removeClass(this.product.slider.ITEMS[e],"active")}}}}},onSliderControlHover:function(){var t=BX.proxy_context;this.mouseTimer=setTimeout(BX.delegate(function(){this.selectSliderImg(t)},this),200)},onSliderControlLeave:function(){clearTimeout(this.mouseTimer);this.mouseTimer=null},selectSliderImg:function(t){var i="",e=[];t=BX.type.isDomNode(t)?t:BX.proxy_context;if(t&&t.hasAttribute("data-value")){i=t.getAttribute("data-value");if(i.indexOf("_")!==-1){e=i.split("_");this.setMainPict(e[0],e[1])}else{this.setProductMainPict(i)}}},setMainPict:function(t,i,e){var s=-1,a=-1,r,o,n="",h="";for(r=0;r<this.offers.length;r++){if(t===this.offers[r].ID){s=r;break}}if(s>-1){if(this.offers[s].SLIDER_COUNT>0){for(o=0;o<this.offers[s].SLIDER.length;o++){if(i===this.offers[s].SLIDER[o].ID){a=o;break}}if(a>-1){if(this.offers[s].SLIDER[a]){this.setCurrentImg(this.offers[s].SLIDER[a],true,e)}h=t+"_"+i;for(r=0;r<this.product.slider.ITEMS.length;r++){n=this.product.slider.ITEMS[r].getAttribute("data-value");if(n===h){BX.addClass(this.product.slider.ITEMS[r],"active")}else if(BX.hasClass(this.product.slider.ITEMS[r],"active")){BX.removeClass(this.product.slider.ITEMS[r],"active")}}}}}},setMainPictFromItem:function(t){if(this.node.imageContainer){var i=false,e={};if(this.offers[t]){if(this.offers[t].DETAIL_PICTURE){e=this.offers[t].DETAIL_PICTURE;i=true}else if(this.offers[t].PREVIEW_PICTURE){e=this.offers[t].PREVIEW_PICTURE;i=true}}if(!i){if(this.defaultPict.detail){e=this.defaultPict.detail;i=true}else if(this.defaultPict.preview){e=this.defaultPict.preview;i=true}}if(i){this.setCurrentImg(e,true,true)}}},toggleMainPictPopup:function(){if(BX.hasClass(this.obBigSlider,"popup")){this.hideMainPictPopup()}else{this.showMainPictPopup()}},showMainPictPopup:function(){this.config.useMagnifier&&this.disableMagnifier(false);BX.addClass(this.obBigSlider,"popup");this.node.imageContainer.style.cursor="";document.body.style.overflow="hidden"},hideMainPictPopup:function(){this.config.useMagnifier&&this.disableMagnifier(false);BX.removeClass(this.obBigSlider,"popup");this.node.imageContainer.style.cursor="zoom-in";document.body.style.overflow=""},closeByEscape:function(i){i=i||t.event;if(i.keyCode==27){this.hideMainPictPopup()}},startQuantityInterval:function(){var t=BX.proxy_context;var i=t.id===this.visual.QUANTITY_DOWN_ID?BX.proxy(this.quantityDown,this):BX.proxy(this.quantityUp,this);this.quantityDelay=setTimeout(BX.delegate(function(){this.quantityTimer=setInterval(i,150)},this),300)},clearQuantityInterval:function(){clearTimeout(this.quantityDelay);clearInterval(this.quantityTimer)},quantityUp:function(){var t=0,i=true;if(this.errorCode===0&&this.config.showQuantity&&this.canBuy&&!this.isGift){t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10);if(!isNaN(t)){t+=this.stepQuantity;t=this.checkQuantityRange(t,"up");if(this.checkQuantity&&t>this.maxQuantity){i=false}if(i){if(this.isDblQuantity){t=Math.round(t*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=t;this.setPrice()}}}},quantityDown:function(){var t=0,i=true;if(this.errorCode===0&&this.config.showQuantity&&this.canBuy&&!this.isGift){t=this.isDblQuantity?parseFloat(this.obQuantity.value):parseInt(this.obQuantity.value,10);if(!isNaN(t)){t-=this.stepQuantity;t=this.checkQuantityRange(t,"down");if(t<this.minQuantity){i=false}if(i){if(this.isDblQuantity){t=Math.round(t*this.precisionFactor)/this.precisionFactor}this.obQuantity.value=t;this.setPrice()}}}},quantityChange:function(){var t=0,i;if(this.errorCode===0&&this.config.showQuantity){if(this.canBuy){t=this.isDblQuantity?parseFloat(this.obQuantity.value):Math.round(this.obQuantity.value);if(!isNaN(t)){t=this.checkQuantityRange(t);if(this.checkQuantity){if(t>this.maxQuantity){t=this.maxQuantity}}this.checkPriceRange(t);i=Math.floor(Math.round(t*this.precisionFactor/this.stepQuantity)/this.precisionFactor)||1;t=i<=1?this.stepQuantity:i*this.stepQuantity;t=Math.round(t*this.precisionFactor)/this.precisionFactor;if(t<this.minQuantity){t=this.minQuantity}this.obQuantity.value=t}else{this.obQuantity.value=this.minQuantity}}else{this.obQuantity.value=this.minQuantity}this.setPrice()}},quantitySet:function(t){var i,e;var s=this.offers[t],a=this.offers[this.offerNum];if(this.errorCode===0){this.canBuy=s.CAN_BUY;this.currentPriceMode=s.ITEM_PRICE_MODE;this.currentPrices=s.ITEM_PRICES;this.currentPriceSelected=s.ITEM_PRICE_SELECTED;this.currentQuantityRanges=s.ITEM_QUANTITY_RANGES;this.currentQuantityRangeSelected=s.ITEM_QUANTITY_RANGE_SELECTED;if(this.canBuy){this.node.quantity&&BX.style(this.node.quantity,"display","");this.obBasketActions&&BX.style(this.obBasketActions,"display","");this.smallCardNodes.buyButton&&BX.style(this.smallCardNodes.buyButton,"display","");this.smallCardNodes.addButton&&BX.style(this.smallCardNodes.addButton,"display","");this.obNotAvail&&BX.style(this.obNotAvail,"display","none");this.smallCardNodes.notAvailableButton&&BX.style(this.smallCardNodes.notAvailableButton,"display","none");this.obSubscribe&&BX.style(this.obSubscribe,"display","none")}else{this.node.quantity&&BX.style(this.node.quantity,"display","none");this.obBasketActions&&BX.style(this.obBasketActions,"display","none");this.smallCardNodes.buyButton&&BX.style(this.smallCardNodes.buyButton,"display","none");this.smallCardNodes.addButton&&BX.style(this.smallCardNodes.addButton,"display","none");this.obNotAvail&&BX.style(this.obNotAvail,"display","");this.smallCardNodes.notAvailableButton&&BX.style(this.smallCardNodes.notAvailableButton,"display","");if(this.obSubscribe){if(s.CATALOG_SUBSCRIBE==="Y"){BX.style(this.obSubscribe,"display","");this.obSubscribe.setAttribute("data-item",s.ID);BX(this.visual.SUBSCRIBE_LINK+"_hidden").click()}else{BX.style(this.obSubscribe,"display","none")}}}this.isDblQuantity=s.QUANTITY_FLOAT;this.checkQuantity=s.CHECK_QUANTITY;if(this.isDblQuantity){this.stepQuantity=Math.round(parseFloat(s.STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor;this.maxQuantity=parseFloat(s.MAX_QUANTITY);this.minQuantity=this.currentPriceMode==="Q"?parseFloat(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity}else{this.stepQuantity=parseInt(s.STEP_QUANTITY,10);this.maxQuantity=parseInt(s.MAX_QUANTITY,10);this.minQuantity=this.currentPriceMode==="Q"?parseInt(this.currentPrices[this.currentPriceSelected].MIN_QUANTITY):this.stepQuantity}if(this.config.showQuantity){var r=a.ITEM_PRICES.length&&a.ITEM_PRICES[a.ITEM_PRICE_SELECTED]&&a.ITEM_PRICES[a.ITEM_PRICE_SELECTED].MIN_QUANTITY!=this.minQuantity;if(this.isDblQuantity){e=Math.round(parseFloat(a.STEP_QUANTITY)*this.precisionFactor)/this.precisionFactor!==this.stepQuantity||r||a.MEASURE!==s.MEASURE||this.checkQuantity&&parseFloat(a.MAX_QUANTITY)>this.maxQuantity&&parseFloat(this.obQuantity.value)>this.maxQuantity}else{e=parseInt(a.STEP_QUANTITY,10)!==this.stepQuantity||r||a.MEASURE!==s.MEASURE||this.checkQuantity&&parseInt(a.MAX_QUANTITY,10)>this.maxQuantity&&parseInt(this.obQuantity.value,10)>this.maxQuantity}this.obQuantity.disabled=!this.canBuy;if(e){this.obQuantity.value=this.minQuantity}if(this.obMeasure){if(s.MEASURE){BX.adjust(this.obMeasure,{html:s.MEASURE})}else{BX.adjust(this.obMeasure,{html:""})}}}if(this.obQuantityLimit.all){if(!this.checkQuantity||this.maxQuantity==0){BX.adjust(this.obQuantityLimit.value,{html:""});BX.adjust(this.obQuantityLimit.all,{style:{display:"none"}})}else{if(this.config.showMaxQuantity==="M"){i=this.maxQuantity/this.stepQuantity>=this.config.relativeQuantityFactor?BX.message("RELATIVE_QUANTITY_MANY"):BX.message("RELATIVE_QUANTITY_FEW")}else{i=this.maxQuantity;if(s.MEASURE){i+=" "+s.MEASURE}}BX.adjust(this.obQuantityLimit.value,{html:i});BX.adjust(this.obQuantityLimit.all,{style:{display:""}})}}if(this.config.usePriceRanges&&this.obPriceRanges){if(this.currentPriceMode==="Q"&&s.PRICE_RANGES_HTML){var o=this.getEntity(this.obPriceRanges,"price-ranges-body"),n=this.getEntity(this.obPriceRanges,"price-ranges-ratio-header");if(o){o.innerHTML=s.PRICE_RANGES_HTML}if(n){n.innerHTML=s.PRICE_RANGES_RATIO_HTML}this.obPriceRanges.style.display=""}else{this.obPriceRanges.style.display="none"}}}},selectOfferProp:function(){var t=0,i="",e=[],s=null,a=BX.proxy_context,r;if(a&&a.hasAttribute("data-treevalue")){if(BX.hasClass(a,"selected"))return;if(typeof document.activeElement==="object"){document.activeElement.blur()}i=a.getAttribute("data-treevalue");e=i.split("_");this.searchOfferPropIndex(e[0],e[1]);s=BX.findChildren(a.parentNode,{tagName:"li"},false);if(s&&s.length){for(t=0;t<s.length;t++){BX.removeClass(s[t],"selected")}}BX.addClass(a,"selected");if(this.smallCardNodes.panel){r=this.smallCardNodes.panel.querySelector('[data-treevalue="'+i+'"]');if(r){s=this.smallCardNodes.panel.querySelectorAll('[data-sku-line="'+r.getAttribute("data-sku-line")+'"]');for(t=0;t<s.length;t++){s[t].style.display="none"}r.style.display=""}}}},searchOfferPropIndex:function(t,i){var e="",s=false,a=[],r=[],o=-1,n,h,l={},u=[];for(n=0;n<this.treeProps.length;n++){if(this.treeProps[n].ID===t){o=n;break}}if(o>-1){for(n=0;n<o;n++){e="PROP_"+this.treeProps[n].ID;l[e]=this.selectedValues[e]}e="PROP_"+this.treeProps[o].ID;l[e]=i;for(n=o+1;n<this.treeProps.length;n++){e="PROP_"+this.treeProps[n].ID;s=this.getRowValues(l,e);if(!s)break;r=[];if(this.config.showAbsent){a=[];u=[];u=BX.clone(l,true);for(h=0;h<s.length;h++){u[e]=s[h];r[r.length]=s[h];if(this.getCanBuy(u))a[a.length]=s[h]}}else{a=s}if(this.selectedValues[e]&&BX.util.in_array(this.selectedValues[e],a)){l[e]=this.selectedValues[e]}else{if(this.config.showAbsent){l[e]=a.length?a[0]:r[0]}else{l[e]=a[0]}}this.updateRow(n,l[e],s,a)}this.selectedValues=l;this.changeInfo()}},updateRow:function(t,i,e,s){var a=0,r="",o=false,n=null;var h=this.getEntities(this.obTree,"sku-line-block");if(t>-1&&t<h.length){n=h[t].querySelectorAll("li");for(a=0;a<n.length;a++){r=n[a].getAttribute("data-onevalue");o=r===i;if(o){BX.addClass(n[a],"selected")}else{BX.removeClass(n[a],"selected")}if(BX.util.in_array(r,s)){BX.removeClass(n[a],"notallowed")}else{BX.addClass(n[a],"notallowed")}n[a].style.display=BX.util.in_array(r,e)?"":"none";if(o){h[t].style.display=r==0&&s.length==1?"none":""}}if(this.smallCardNodes.panel){n=this.smallCardNodes.panel.querySelectorAll('[data-sku-line="'+t+'"]');for(a=0;a<n.length;a++){r=n[a].getAttribute("data-onevalue");o=r===i;if(o){n[a].style.display=""}else{n[a].style.display="none"}if(BX.util.in_array(r,s)){BX.removeClass(n[a],"notallowed")}else{BX.addClass(n[a],"notallowed")}if(o){n[a].style.display=r==0&&s.length==1?"none":""}}}}},getRowValues:function(t,i){var e=[],s=0,a=0,r=false,o=true;if(t.length===0){for(s=0;s<this.offers.length;s++){if(!BX.util.in_array(this.offers[s].TREE[i],e)){e[e.length]=this.offers[s].TREE[i]}}r=true}else{for(s=0;s<this.offers.length;s++){o=true;for(a in t){if(t[a]!==this.offers[s].TREE[a]){o=false;break}}if(o){if(!BX.util.in_array(this.offers[s].TREE[i],e)){e[e.length]=this.offers[s].TREE[i]}r=true}}}return r?e:false},getCanBuy:function(t){var i,e=0,s=true,a=false;for(i=0;i<this.offers.length;i++){s=true;for(e in t){if(t[e]!==this.offers[i].TREE[e]){s=false;break}}if(s){if(this.offers[i].CAN_BUY){a=true;break}}}return a},setCurrent:function(){var t,i=0,e="",s=false,a=[],r={},o=[],n=this.offers[this.offerNum].TREE;for(t=0;t<this.treeProps.length;t++){e="PROP_"+this.treeProps[t].ID;s=this.getRowValues(r,e);if(!s)break;if(BX.util.in_array(n[e],s)){r[e]=n[e]}else{r[e]=s[0];this.offerNum=0}if(this.config.showAbsent){a=[];o=[];o=BX.clone(r,true);for(i=0;i<s.length;i++){o[e]=s[i];if(this.getCanBuy(o)){a[a.length]=s[i]}}}else{a=s}this.updateRow(t,r[e],s,a)}this.selectedValues=r;this.changeInfo()},changeInfo:function(){var t=-1,i=0,e=true,s={currentId:this.offerNum>-1?this.offers[this.offerNum].ID:0,newId:0};var a,r;for(a=0;a<this.offers.length;a++){e=true;for(i in this.selectedValues){if(this.selectedValues[i]!==this.offers[a].TREE[i]){e=false;break}}if(e){t=a;break}}if(t>-1){if(t!=this.offerNum){this.isGift=false}this.drawImages(this.offers[t].SLIDER);this.checkSliderControls(this.offers[t].SLIDER_COUNT);for(a=0;a<this.offers.length;a++){if(this.config.showOfferGroup&&this.offers[a].OFFER_GROUP){if(r=BX(this.visual.OFFER_GROUP+this.offers[a].ID)){r.style.display=a==t?"":"none"}}if(this.slider.controls[a].ID){if(a===t){this.product.slider=this.slider.controls[a];this.slider.controls[a].CONT&&BX.show(this.slider.controls[a].CONT)}else{this.slider.controls[a].CONT&&BX.hide(this.slider.controls[a].CONT)}}else if(a===t){this.product.slider={}}}if(this.offers[t].SLIDER_COUNT>0){this.setMainPict(this.offers[t].ID,this.offers[t].SLIDER[0].ID,true)}else{this.setMainPictFromItem(t)}if(this.offers[t].SLIDER_COUNT>1){this.initSlider()}else{this.stopSlider()}if(this.config.showSkuProps){if(this.obSkuProps){if(!this.offers[t].DISPLAY_PROPERTIES){BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})}else{BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[t].DISPLAY_PROPERTIES})}}if(this.obMainSkuProps){if(!this.offers[t].DISPLAY_PROPERTIES_MAIN_BLOCK){BX.adjust(this.obMainSkuProps,{style:{display:"none"},html:""})}else{BX.adjust(this.obMainSkuProps,{style:{display:""},html:this.offers[t].DISPLAY_PROPERTIES_MAIN_BLOCK})}}}this.quantitySet(t);this.setPrice();this.setCompared(this.offers[t].COMPARED);this.offerNum=t;this.fixFontCheck();this.setAnalyticsDataLayer("showDetail");this.incViewedCounter();s.newId=this.offers[this.offerNum].ID;BX.onCustomEvent("onCatalogStoreProductChange",[this.offers[this.offerNum].ID]);BX.onCustomEvent("onCatalogElementChangeOffer",[s]);s=null}},drawImages:function(t){if(!this.node.imageContainer)return;var i,e,s=this.getEntities(this.node.imageContainer,"image");for(i in s){if(s.hasOwnProperty(i)&&BX.type.isDomNode(s[i])){BX.remove(s[i])}}for(i=0;i<t.length;i++){e=BX.create("IMG",{props:{src:t[i].SRC,alt:this.config.alt,title:this.config.title}});if(i==0){e.setAttribute("itemprop","image")}this.node.imageContainer.appendChild(BX.create("DIV",{attrs:{"data-entity":"image","data-id":t[i].ID},props:{className:"product-item-detail-slider-image"+(i==0?" active":"")},children:[e]}))}},restoreSticker:function(){if(this.previousStickerText){this.redrawSticker({text:this.previousStickerText})}else{this.hideSticker()}},hideSticker:function(){BX.hide(BX(this.visual.STICKER_ID))},redrawSticker:function(t){t=t||{};var i=t.text||"";var e=BX(this.visual.STICKER_ID);if(!e)return;BX.show(e);var s=e.getAttribute("title");if(s&&s!=i){this.previousStickerText=s}BX.adjust(e,{text:i,attrs:{title:i}})},checkQuantityRange:function(t,i){if(typeof t==="undefined"||this.currentPriceMode!=="Q"){return t}t=parseFloat(t);var e=t;var s,a,r,o,n,h;for(var l in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(l)){s=this.currentQuantityRanges[l];if(parseFloat(t)>=parseFloat(s.SORT_FROM)&&(s.SORT_TO==="INF"||parseFloat(t)<=parseFloat(s.SORT_TO))){e=t;break}else{a=parseFloat(s.SORT_FROM)-t;r=Math.abs(a);o=parseFloat(s.SORT_TO)-t;n=Math.abs(o);if(h===undefined||h>r){if(i===undefined||i==="up"&&a>0||i==="down"&&a<0){h=r;e=parseFloat(s.SORT_FROM)}}if(h===undefined||h>n){if(i===undefined||i==="up"&&a>0||i==="down"&&a<0){h=n;e=parseFloat(s.SORT_TO)}}}}}return e},checkPriceRange:function(t){if(typeof t==="undefined"||this.currentPriceMode!=="Q"){return}var i,e=false;for(var s in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(s)){i=this.currentQuantityRanges[s];if(parseFloat(t)>=parseFloat(i.SORT_FROM)&&(i.SORT_TO==="INF"||parseFloat(t)<=parseFloat(i.SORT_TO))){e=true;this.currentQuantityRangeSelected=i.HASH;break}}}if(!e&&(i=this.getMinPriceRange())){this.currentQuantityRangeSelected=i.HASH}for(var a in this.currentPrices){if(this.currentPrices.hasOwnProperty(a)){if(this.currentPrices[a].QUANTITY_HASH==this.currentQuantityRangeSelected){this.currentPriceSelected=a;break}}}},getMinPriceRange:function(){var t;for(var i in this.currentQuantityRanges){if(this.currentQuantityRanges.hasOwnProperty(i)){if(!t||parseInt(this.currentQuantityRanges[i].SORT_FROM)<parseInt(t.SORT_FROM)){t=this.currentQuantityRanges[i]}}}return t},checkQuantityControls:function(){if(!this.obQuantity)return;var t=this.checkQuantity&&parseFloat(this.obQuantity.value)+this.stepQuantity>this.maxQuantity,i=parseFloat(this.obQuantity.value)-this.stepQuantity<this.minQuantity;if(t){BX.addClass(this.obQuantityUp,"product-item-amount-field-btn-disabled")}else if(BX.hasClass(this.obQuantityUp,"product-item-amount-field-btn-disabled")){BX.removeClass(this.obQuantityUp,"product-item-amount-field-btn-disabled")}if(i){BX.addClass(this.obQuantityDown,"product-item-amount-field-btn-disabled")}else if(BX.hasClass(this.obQuantityDown,"product-item-amount-field-btn-disabled")){BX.removeClass(this.obQuantityDown,"product-item-amount-field-btn-disabled")}if(t&&i){this.obQuantity.setAttribute("disabled","disabled")}else{this.obQuantity.removeAttribute("disabled")}},setPrice:function(){var t="",i;if(this.obQuantity){this.checkPriceRange(this.obQuantity.value)}this.checkQuantityControls();i=this.currentPrices[this.currentPriceSelected];if(this.isGift){i.PRICE=0;i.DISCOUNT=i.BASE_PRICE;i.PERCENT=100}if(this.obPrice.price){if(i){BX.adjust(this.obPrice.price,{html:BX.Currency.currencyFormat(i.RATIO_PRICE,i.CURRENCY,true)});this.smallCardNodes.price&&BX.adjust(this.smallCardNodes.price,{html:BX.Currency.currencyFormat(i.RATIO_PRICE,i.CURRENCY,true)})}else{BX.adjust(this.obPrice.price,{html:""});this.smallCardNodes.price&&BX.adjust(this.smallCardNodes.price,{html:""})}if(i&&i.RATIO_PRICE!==i.RATIO_BASE_PRICE){if(this.config.showOldPrice){this.obPrice.full&&BX.adjust(this.obPrice.full,{style:{display:""},html:BX.Currency.currencyFormat(i.RATIO_BASE_PRICE,i.CURRENCY,true)});this.smallCardNodes.oldPrice&&BX.adjust(this.smallCardNodes.oldPrice,{style:{display:""},html:BX.Currency.currencyFormat(i.RATIO_BASE_PRICE,i.CURRENCY,true)});if(this.obPrice.discount){t=BX.message("ECONOMY_INFO_MESSAGE");t=t.replace("#ECONOMY#",BX.Currency.currencyFormat(i.RATIO_DISCOUNT,i.CURRENCY,true));BX.adjust(this.obPrice.discount,{style:{display:""},html:t})}}if(this.config.showPercent){this.obPrice.percent&&BX.adjust(this.obPrice.percent,{style:{display:""},html:-i.PERCENT+"%"})}}else{if(this.config.showOldPrice){this.obPrice.full&&BX.adjust(this.obPrice.full,{style:{display:"none"},html:""});this.smallCardNodes.oldPrice&&BX.adjust(this.smallCardNodes.oldPrice,{style:{display:"none"},html:""});this.obPrice.discount&&BX.adjust(this.obPrice.discount,{style:{display:"none"},html:""})}if(this.config.showPercent){this.obPrice.percent&&BX.adjust(this.obPrice.percent,{style:{display:"none"},html:""})}}if(this.obPrice.total){if(i&&this.obQuantity&&this.obQuantity.value!=this.stepQuantity){BX.adjust(this.obPrice.total,{html:BX.message("PRICE_TOTAL_PREFIX")+" <strong>"+BX.Currency.currencyFormat(i.PRICE*this.obQuantity.value,i.CURRENCY,true)+"</strong>",style:{display:""}})}else{BX.adjust(this.obPrice.total,{html:"",style:{display:"none"}})}}}},compare:function(t){var i=this.obCompare.querySelector('[data-entity="compare-checkbox"]'),e=BX.getEventTarget(t),s=true;if(i){s=e===i?i.checked:!i.checked}var a=s?this.compareData.compareUrl:this.compareData.compareDeleteUrl,r;if(a){if(e!==i){BX.PreventDefault(t);this.setCompared(s)}switch(this.productType){case 0:case 1:case 2:r=a.replace("#ID#",this.product.id.toString());break;case 3:r=a.replace("#ID#",this.offers[this.offerNum].ID);break}BX.ajax({method:"POST",dataType:s?"json":"html",url:r+(r.indexOf("?")!==-1?"&":"?")+"ajax_action=Y",onsuccess:s?BX.proxy(this.compareResult,this):BX.proxy(this.compareDeleteResult,this)})}},compareResult:function(t){var e,s;if(this.obPopupWin){this.obPopupWin.close()}if(!BX.type.isPlainObject(t))return;this.initPopupWindow();if(this.offers.length>0){this.offers[this.offerNum].COMPARED=t.STATUS==="OK"}if(t.STATUS==="OK"){BX.onCustomEvent("OnCompareChange");e='<div style="width: 100%; margin: 0; text-align: center;"><p>'+BX.message("COMPARE_MESSAGE_OK")+"</p></div>";if(this.config.showClosePopup){s=[new i({text:BX.message("BTN_MESSAGE_COMPARE_REDIRECT"),events:{click:BX.delegate(this.compareRedirect,this)},style:{marginRight:"10px"}}),new i({text:BX.message("BTN_MESSAGE_CLOSE_POPUP"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}else{s=[new i({text:BX.message("BTN_MESSAGE_COMPARE_REDIRECT"),events:{click:BX.delegate(this.compareRedirect,this)}})]}}else{e='<div style="width: 100%; margin: 0; text-align: center;"><p>'+(t.MESSAGE?t.MESSAGE:BX.message("COMPARE_UNKNOWN_ERROR"))+"</p></div>";s=[new i({text:BX.message("BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}this.obPopupWin.setTitleBar(BX.message("COMPARE_TITLE"));this.obPopupWin.setContent(e);this.obPopupWin.setButtons(s);this.obPopupWin.show()},compareDeleteResult:function(){BX.onCustomEvent("OnCompareChange");if(this.offers&&this.offers.length){this.offers[this.offerNum].COMPARED=false}},setCompared:function(t){if(!this.obCompare)return;var i=this.getEntity(this.obCompare,"compare-checkbox");if(i){i.checked=t}},setCompareInfo:function(t){if(!BX.type.isArray(t))return;for(var i in this.offers){if(this.offers.hasOwnProperty(i)){this.offers[i].COMPARED=BX.util.in_array(this.offers[i].ID,t)}}},compareRedirect:function(){if(this.compareData.comparePath){location.href=this.compareData.comparePath}else{this.obPopupWin.close()}},checkDeletedCompare:function(t){switch(this.productType){case 0:case 1:case 2:if(this.product.id==t){this.setCompared(false)}break;case 3:var i=this.offers.length;while(i--){if(this.offers[i].ID==t){this.offers[i].COMPARED=false;if(this.offerNum==i){this.setCompared(false)}break}}}},initBasketUrl:function(){this.basketUrl=this.basketMode==="ADD"?this.basketData.add_url:this.basketData.buy_url;switch(this.productType){case 1:case 2:this.basketUrl=this.basketUrl.replace("#ID#",this.product.id.toString());break;case 3:this.basketUrl=this.basketUrl.replace("#ID#",this.offers[this.offerNum].ID);break}this.basketParams={ajax_basket:"Y"};if(this.config.showQuantity){this.basketParams[this.basketData.quantity]=this.obQuantity.value}if(this.basketData.sku_props){this.basketParams[this.basketData.sku_props_var]=this.basketData.sku_props}},fillBasketProps:function(){if(!this.visual.BASKET_PROP_DIV)return;var t=0,i=null,e=false,s=null;if(this.basketData.useProps&&!this.basketData.emptyProps){if(this.obPopupWin&&this.obPopupWin.contentContainer){s=this.obPopupWin.contentContainer}}else{s=BX(this.visual.BASKET_PROP_DIV)}if(s){i=s.getElementsByTagName("select");if(i&&i.length){for(t=0;t<i.length;t++){if(!i[t].disabled){switch(i[t].type.toLowerCase()){case"select-one":this.basketParams[i[t].name]=i[t].value;e=true;break;default:break}}}}i=s.getElementsByTagName("input");if(i&&i.length){for(t=0;t<i.length;t++){if(!i[t].disabled){switch(i[t].type.toLowerCase()){case"hidden":this.basketParams[i[t].name]=i[t].value;e=true;break;case"radio":if(i[t].checked){this.basketParams[i[t].name]=i[t].value;e=true}break;default:break}}}}}if(!e){this.basketParams[this.basketData.props]=[];this.basketParams[this.basketData.props][0]=0}},sendToBasket:function(){if(!this.canBuy)return;this.initBasketUrl();this.fillBasketProps();BX.ajax({method:"POST",dataType:"json",url:this.basketUrl,data:this.basketParams,onsuccess:BX.proxy(this.basketResult,this)})},add2Basket:function(){this.basketMode="ADD";this.basket()},buyBasket:function(){this.basketMode="BUY";this.basket()},basket:function(){var t="";if(!this.canBuy)return;switch(this.productType){case 1:case 2:if(this.basketData.useProps&&!this.basketData.emptyProps){this.initPopupWindow();this.obPopupWin.setTitleBar(BX.message("TITLE_BASKET_PROPS"));if(BX(this.visual.BASKET_PROP_DIV)){t=BX(this.visual.BASKET_PROP_DIV).innerHTML}this.obPopupWin.setContent(t);this.obPopupWin.setButtons([new i({text:BX.message("BTN_SEND_PROPS"),events:{click:BX.delegate(this.sendToBasket,this)}})]);this.obPopupWin.show()}else{this.sendToBasket()}break;case 3:this.sendToBasket();break}},basketResult:function(t){var e,s,a;if(this.obPopupWin){this.obPopupWin.close()}if(!BX.type.isPlainObject(t))return;if(t.STATUS==="OK"){this.setAnalyticsDataLayer("addToCart")}if(t.STATUS==="OK"&&this.basketMode==="BUY"){this.basketRedirect()}else{this.initPopupWindow();if(t.STATUS==="OK"){BX.onCustomEvent("OnBasketChange");switch(this.productType){case 1:case 2:a=this.product.pict.SRC;break;case 3:a=this.offers[this.offerNum].PREVIEW_PICTURE?this.offers[this.offerNum].PREVIEW_PICTURE.SRC:this.defaultPict.pict.SRC;break}e='<div style="width: 100%; margin: 0; text-align: center;">'+'<img src="'+a+'" height="130" style="max-height:130px"><p>'+this.product.name+"</p></div>";if(this.config.showClosePopup){s=[new i({text:BX.message("BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(this.basketRedirect,this)},style:{marginRight:"10px"}}),new i({text:BX.message("BTN_MESSAGE_CLOSE_POPUP"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}else{s=[new i({text:BX.message("BTN_MESSAGE_BASKET_REDIRECT"),events:{click:BX.delegate(this.basketRedirect,this)}})]}}else{e='<div style="width: 100%; margin: 0; text-align: center;"><p>'+(t.MESSAGE?t.MESSAGE:BX.message("BASKET_UNKNOWN_ERROR"))+"</p></div>";s=[new i({text:BX.message("BTN_MESSAGE_CLOSE"),events:{click:BX.delegate(this.obPopupWin.close,this.obPopupWin)}})]}this.obPopupWin.setTitleBar(t.STATUS==="OK"?BX.message("TITLE_SUCCESSFUL"):BX.message("TITLE_ERROR"));this.obPopupWin.setContent(e);this.obPopupWin.setButtons(s);this.obPopupWin.show()}},basketRedirect:function(){location.href=this.basketData.basketUrl?this.basketData.basketUrl:BX.message("BASKET_URL")},initPopupWindow:function(){if(this.obPopupWin)return;this.obPopupWin=BX.PopupWindowManager.create("CatalogElementBasket_"+this.visual.ID,null,{autoHide:false,offsetLeft:0,offsetTop:0,overlay:true,closeByEsc:true,titleBar:true,closeIcon:true,contentColor:"white",className:this.config.templateTheme?"bx-"+this.config.templateTheme:""})},incViewedCounter:function(){if(this.currentIsSet&&!this.updateViewedCount){switch(this.productType){case 1:case 2:this.viewedCounter.params.PRODUCT_ID=this.product.id;this.viewedCounter.params.PARENT_ID=this.product.id;break;case 3:this.viewedCounter.params.PARENT_ID=this.product.id;this.viewedCounter.params.PRODUCT_ID=this.offers[this.offerNum].ID;break;default:return}this.viewedCounter.params.SITE_ID=BX.message("SITE_ID");this.updateViewedCount=true;BX.ajax.post(this.viewedCounter.path,this.viewedCounter.params,BX.delegate(function(){this.updateViewedCount=false},this))}},allowViewedCount:function(t){this.currentIsSet=true;if(t){this.incViewedCounter()}},fixFontCheck:function(){if(BX.type.isDomNode(this.obPrice.price)){BX.FixFontSize&&BX.FixFontSize.init({objList:[{node:this.obPrice.price,maxFontSize:28,smallestValue:false,scaleBy:this.obPrice.price.parentNode}],onAdaptiveResize:true})}}}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/local/templates/shop/components/bitrix/forum.topic.reviews/Forum_comment/script.min.js?159706558816915";s:6:"source";s:83:"/local/templates/shop/components/bitrix/forum.topic.reviews/Forum_comment/script.js";s:3:"min";s:87:"/local/templates/shop/components/bitrix/forum.topic.reviews/Forum_comment/script.min.js";s:3:"map";s:87:"/local/templates/shop/components/bitrix/forum.topic.reviews/Forum_comment/script.map.js";}"*/
(function(e){BX.namespace("BX.Forum");var t=function(e){this.id="FTRList"+e.form.id;this.mess={};this.form=e.form;if(!!e["id"]){for(var t=0;t<e["id"].length;t++){this.bind(e["id"][t])}}this.params={preorder:e.preorder=="Y",pageNumber:e.pageNumber,pageCount:e.pageCount};BX.addCustomEvent(this.form,"onAdd",BX.delegate(this.add,this));BX.addCustomEvent(this.form,"onRequest",BX.delegate(function(){if(typeof this.params.pageNumber!="undefined"){var e=this.form.elements["pageNumber"];if(!e){e=BX.create("input",{props:{type:"hidden",name:"pageNumber"}});this.form.appendChild(e)}e.value=this.params.pageNumber}if(typeof this.params.pageCount!="undefined"){var t=BX.findChild(this.form,{attr:{name:"pageCount"}});if(!t){t=BX.create("input",{props:{type:"hidden",name:"pageCount"}});this.form.appendChild(t)}t.value=this.params.pageCount}},this));BX.addCustomEvent(this.form,"onResponse",BX.delegate(function(){var e=BX.findChild(this.form,{attr:{name:"pageNumber"}},true);if(e){BX.remove(e)}},this))};t.prototype={add:function(t,i){var s=BX(this.form.id+"container"),r,a={className:/reviews-reply-form|reviews-collapse/},o=e.fTextToNode(i.message);if(!s){s=BX.create("div",{attrs:{id:this.form.id+"container"},props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]});e.fReplaceOrInsertNode(s,null,BX.findChild(document,a,true).parentNode,a);s=BX(this.form.id+"container")}r=s?BX.findChild(s,{className:"reviews-block-inner"},true):null;if(o&&r){if(!!i["allMessages"]){e.fReplaceOrInsertNode(o,r,BX.findChild(document,a,true).parentNode,a);if(!!i.navigation&&!!i.pageNumber){var n=e.fTextToNode(i.navigation),l,d=n?BX.findChildren(s.parentNode,{className:"reviews-navigation-box"},true):null;if(n){if(!d){s.parentNode.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),s);var f=s;do{f=f.nextSibling}while(f&&f.nodeType!=1);var h=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});if(f)s.parentNode.insertBefore(h,f);else s.parentNode.appendChild(h);d=BX.findChildren(s.parentNode,{className:"reviews-navigation-box"},true)}for(l=0;l<d.length;l++)d[l].innerHTML=n.innerHTML}this.params.pageNumber=i.pageNumber;this.params.pageCount=i.pageCount}if(i["messagesID"]&&typeof i["messagesID"]=="object"){for(var u=0;u<i["messagesID"].length;u++){if(i["messagesID"][u]!=t)this.bind(i["messagesID"][u])}}}else if(typeof i.message!="undefined"){if(this.params.preorder)r.appendChild(o);else r.insertBefore(o,r.firstChild)}e.fRunScripts(i.message);this.bind(t)}},bind:function(e){var t=BX("message"+e);if(!!t){this.mess["m"+e]={node:t,author:{id:t.getAttribute("bx-author-id"),name:t.getAttribute("bx-author-name")}};var i=BX.findChildren(t,{tagName:"A",className:"reviews-button-small"},true),s=BX.delegate(function(){var t=BX.proxy_context;this.act(t.getAttribute("bx-act"),e)},this),r=BX.delegate(function(){this.act("reply",e)},this),a=BX.delegate(function(){this.act("quote",e)},this);if(!!i&&i.length>0){for(var o=0;o<i.length;o++){if(i[o].getAttribute("bx-act")=="moderate"||i[o].getAttribute("bx-act")=="del"){BX.adjust(i[o],{events:{click:s},attrs:{"bx-href":i[o].getAttribute("href"),href:"javascript:void(0);"}})}else if(!!this.form){if(i[o].getAttribute("bx-act")=="reply"){BX.bind(i[o],"click",r)}else if(i[o].getAttribute("bx-act")=="quote"){BX.bind(i[o],"mousedown",a)}}}}}},act:function(t,i){if(!i||!this.mess["m"+i]){BX.DoNothing()}else if(t=="quote"){var s=e.GetSelection();if(document["getSelection"]){s=s.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ");s=s.replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")}if(s===""&&i>0&&BX("message_text_"+i,true)){var r=BX("message_text_"+i,true);if(typeof r=="object"&&r)s=r.innerHTML}s=s.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n");var a=function(e,t){var i=" ";var s=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi;var r=s.exec(t);if(r)i="[VIDEO WIDTH="+r[2]+" HEIGHT="+r[3]+"]"+r[1]+"[/VIDEO]";if(i==" "){var a=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi;r=a.exec(t);if(r)i="[VIDEO WIDTH="+r[3]+" HEIGHT="+r[2]+"]"+r[1]+"[/VIDEO]"}return i};s=s.replace(/<script[^>]*>/gi,"").replace(/<\/script[^>]*>/gi,"");s=s.replace(/\001([^\002]*)\002/gi,a);s=s.replace(/<noscript[^>]*>/gi,"").replace(/<\/noscript[^>]*>/gi,"");s=s.replace(/\003([^\004]*)\004/gi," ");s=s.replace(/<table class\=[\"]*forum-quote[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"");s=s.replace(/<table class\=[\"]*forum-code[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"");s=s.replace(/<table class\=[\"]*data-table[\"]*>[^<]*<tbody>/gi,"");s=s.replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,"");s=s.replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");var o=0;while(o++<50&&(s.search(/\002([^\002\003]*)\003/gi)>=0||s.search(/\001([^\001\003]*)\003/gi)>=0)){s=s.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]")}var n=function(e,t,i){var s=new RegExp("([^]*)("+t+")([^]*)","i");var r=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i");var a=0;while(a++<300&&e.search(s)>=0)e=e.replace(r,"$1"+i+"$3");return e};o=0;while(o++<10&&s.search(/\004([^\004\003]*)\003/gi)>=0){s=n(s,"<tr>","[TR]");s=n(s,"</tr>","[/TR]");s=n(s,"<td>","[TD]");s=n(s,"</td>","[/TD]");s=s.replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]")}if(BX.browser.IsIE())s=s.replace(/<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1");else s=s.replace(/<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*>/gi,"$1");s=s.replace(/<a[^>]+href=[\"]([^\"]+)\"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]");s=s.replace(/<a[^>]+href=[\']([^\']+)\'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]");s=s.replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"');s=s.replace(/(smile(?=[:;8]))/g,"");s=s.replace(/\&shy;/gi,"");s=s.replace(/\&nbsp;/gi," ");BX.onCustomEvent(this.form,"onQuote",[{author:this.mess["m"+i]["author"],id:i,text:s}])}else if(t=="reply"){BX.onCustomEvent(this.form,"onReply",[{author:this.mess["m"+i]["author"],id:i}])}else if(t=="del"&&!confirm(BX.message("f_cdm"))){BX.DoNothing()}else if(t=="moderate"||t=="del"){var l=BX.proxy_context,d=l.getAttribute("bx-href").replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),f=BX.findParent(l,{tag:"table"}),h=BX.create("a",{attrs:{className:"reply-action-note"}}),u=function(){BX.remove(h);BX.show(l.parentNode)};BX.hide(l.parentNode);h.innerHTML=BX.message("f_wait");l.parentNode.parentNode.appendChild(h);BX.ajax.loadJSON(d,{AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},BX.delegate(function(i){if(i.status&&!!f){BX.onCustomEvent(e,"onForumCommentAJAXAction",[t]);if(t=="del"){var s=e["curpage"]||top.window.location.href;BX.fx.hide(f,"scroll",{time:.15,callback_complete:BX.delegate(function(){BX.remove(f);u();var e=BX.findChild(BX(this.form.id+"container"),{"class":"reviews-post-table"},true,true);if(!e||e.length<1)if(this.params.pageNumber>1)BX.reload(s)},this)})}else{var r=BX.hasClass(f,"reviews-post-hidden");var a=r?BX.message("f_hide"):BX.message("f_show");var o=BX.findChild(f,{className:"reviews-text"},true);BX.fx.hide(o,"fade",{time:.1,callback_complete:function(){BX.toggleClass(f,"reviews-post-hidden");l.innerHTML=a;d=d.replace(new RegExp("REVIEW_ACTION="+(r?"SHOW":"HIDE")),"REVIEW_ACTION="+(r?"HIDE":"SHOW"));l.setAttribute("bx-href",d);BX.fx.show(o,"fade",{time:.1});u();BX.style(o,"background-color",r?"#FFFFFF":"#E5F8E3")}})}}else{BX.addClass(h,"error");h.innerHTML='<span class="errortext">'+i.message+"</span>"}},this))}return false}};var i=function(){var t=function(e,t){this.id="FTRForm"+e.form.id;this.form=e.form;this.editor=t;this.windowEvents={};this.params={messageMax:64e3};this.onsuccess=BX.delegate(this.onsuccess,this);this.onfailure=BX.delegate(this.onfailure,this);this.submit=BX.delegate(this.submit,this);BX.bind(this.form,"submit",this.submit);this.isAjax=e["ajaxPost"]=="Y";if(e["captcha"]=="Y"){var i=new Captcha(this.form);BX.addCustomEvent(t,"OnContentChanged",BX.proxy(i.Show,i));BX.ready(function(){BX.bind(BX("forum-refresh-captcha"),"click",BX.proxy(i.Update,i))});if(e["bVarsFromForm"]=="Y")i.Show()}BX.addCustomEvent(this.form,"onQuote",BX.delegate(function(e){this.show();this.quote(e)},this));BX.addCustomEvent(this.form,"onReply",BX.delegate(function(e){this.show();this.paste(e)},this));BX.addCustomEvent(this.form,"onTransverse",BX.delegate(this.transverse,this))};t.prototype={submit:function(e){if(this.validate()){this.prepareForm();this.disableButtons(true);if(!this.isAjax)return true;this.send()}return BX.PreventDefault(e)},prepareForm:function(){},disableButtons:function(e){var t=this.form.getElementsByTagName("input");for(var i=0;i<t.length;i++){if(t[i].getAttribute("type")=="submit")t[i].disabled=e!==false}},validate:function(){this.editor.SaveContent();var e="",t=this.editor.GetContent(),i=t.length,s=64e3;if(this.form.TITLE&&this.form.TITLE.value.length<=0)e+=BX.message("no_topic_name");if(i<=0)e+=BX.message("no_message");else if(i>s)e+=BX.message("max_len").replace(/#MAX_LENGTH#/gi,s).replace(/#LENGTH#/gi,i);if(e!==""){alert(e);return false}return true},busy:false,send:function(){if(this.busy===true)return false;this.busy=true;if(!this.form.elements["dataType"])this.form.appendChild(BX.create("input",{props:{type:"hidden",name:"dataType",value:"json"}}));BX.onCustomEvent(this.form,"onRequest",[this.form,this]);BX.ajax.submitAjax(this.form,{method:"POST",url:this.form.action,dataType:"json",onsuccess:this.onsuccess,onfailure:this.onfailure});return true},onsuccess:function(e){this.busy=false;this.disableButtons(false);BX.onCustomEvent(this.form,"onResponse",[this.form,this]);this.get(e)},onfailure:function(){BX.onCustomEvent(this.form,"onResponse",[this.form,this]);BX.reload()},get:function(t){e["curpage"]=e["curpage"]||top.window.location.href;BX.onCustomEvent(e,"onForumCommentAJAXPost",[t,this.form]);if(typeof t=="undefined"||t.reload){BX.reload(e["curpage"]);return}if(t["status"]){if(!!t["allMessages"]||typeof t["message"]!="undefined"){BX.onCustomEvent(this.form,"onAdd",[t["messageID"],t]);this.clear()}else if(!!t["previewMessage"]){var i=BX.findChild(document,{className:"reviews-preview"},true),s=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},true).parentNode,r=e.fTextToNode(t["previewMessage"]);e.fReplaceOrInsertNode(r,i,s,{className:/reviews-reply-form|reviews-collapse/});e.PostFormAjaxStatus("");e.fRunScripts(t["previewMessage"])}var a=!!t["messageID"]?BX("message"+t["messageID"]):null;if(a){BX.scrollToNode(a)}}if(t["statusMessage"])e.PostFormAjaxStatus(t["statusMessage"])},clear:function(){this.editor.CheckAndReInit("");if(this.editor.fAutosave)BX.bind(this.editor.pEditorDocument,"keydown",BX.proxy(this.editor.fAutosave.Init,this.editor.fAutosave));var e=BX.findChild(document,{className:"reviews-preview"},true);if(e)BX.remove(e);var t=0,i,s,r;while((i=BX("upload_files_"+t++ +"_"+this.form.index.value))&&i){if((s=BX.findChild(i,{tagName:"input"},true))&&BX(s)){r=BX.clone(s);r.value="";s.parentNode.insertBefore(r,s);s.parentNode.removeChild(s)}BX.hide(i)}var a=BX.findChild(this.form,{className:"forum-upload-file-attach"},true);if(a)BX.show(a);var o=BX.findChild(this.form,{className:"reviews-upload-info"},true);if(o)BX.hide(o);var n=null,l=BX.findChild(this.form,{attr:{name:"captcha_code"}},true),d=BX.findChild(this.form,{attr:{name:"captcha_word"}},true),f=BX.findChild(this.form,{className:"reviews-reply-field-captcha-image"},true);if(f)n=BX.findChild(f,{tag:"img"});if(l&&d&&n){d.value="";BX.ajax.getCaptcha(function(e){l.value=e["captcha_sid"];n.src="/bitrix/tools/captcha.php?captcha_code="+e["captcha_sid"]})}},show:function(){BX.onCustomEvent(this.form,"onBeforeShow",[this]);BX.show(this.form.parentNode);BX.scrollToNode(BX.findChild(this.form,{attribute:{name:"send_button"}},true));setTimeout(BX.delegate(function(){this.editor.Focus();BX.defer(this.editor.Focus,this.editor)()},this),100);BX.onCustomEvent(this.form,"onAfterShow",[this]);return false},hide:function(){BX.onCustomEvent(this.form,"onBeforeHide",[this]);BX.hide(this.form.parentNode);BX.onCustomEvent(this.form,"onAfterHide",[this]);return false},transverse:function(){if(this.form.parentNode.style.display=="none")this.show();else this.hide();return false},quote:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"QUOTE",this]);var t=e["author"]||null,i=e["text"]||"",s=i;if(this.editor.GetViewMode()=="wysiwyg"){s=s.replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/g,"<br/>");if(t){if(t.id>0)t='<span id="'+this.editor.SetBxTag(false,{tag:"postuser",params:{value:t.id}})+'" class="bxhtmled-metion">'+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";else t="<span>"+t.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")+"</span>";t=t!==""?t+BX.message("f_author")+"<br/>":"";s=t+s}}else if(this.editor.bbCode&&t){if(t.id>0)t="[USER="+t.id+"]"+t.name+"[/USER]";else t=t.name;t=t!==""?t+BX.message("f_author")+"\n":"";s=t+s}this.editor.action.actions.quote.setExternalSelection(s);this.editor.action.Exec("quote")},paste:function(e){BX.onCustomEvent(this.form,"onPaste",[e,"REPLY",this]);var t=e["author"]||null;if(t){if(this.editor.GetViewMode()=="wysiwyg"){var i=this.editor.GetIframeDoc(),s=this.editor.selection.GetRange(),r=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},i),a=BX.create("SPAN",{html:",&nbsp;"},i);this.editor.SetBxTag(r,{tag:"postuser",params:{value:t.id}});this.editor.selection.InsertNode(r,s);if(r&&r.parentNode){var o=BX.findParent(r,{className:"bxhtmled-metion"},i.body);if(o){this.editor.util.InsertAfter(r,o)}}if(r&&r.parentNode){this.editor.util.InsertAfter(a,r);this.editor.selection.SetAfter(a)}}else if(this.editor.GetViewMode()=="code"&&this.editor.bbCode){this.editor.textareaView.Focus();this.editor.textareaView.WrapWith(false,false,"[USER="+t.id+"]"+t.name+"[/USER],")}}}};return t}(),s=[];BX.Forum.Init=function(i){if(!i||typeof i!="object")return;new t(i);var a,o;while((a=s.pop())&&a)BX.removeCustomEvent(e,"OnEditorInitedAfter",a);o=function(t){r(t,i);BX.removeCustomEvent(e,"OnEditorInitedAfter",o)};s.push(o);BX.addCustomEvent(e,"OnEditorInitedAfter",o)};var r=function(e,t){if(e.id==t.lheId){e.insertImageAfterUpload=true;BX.bind(BX("post_message_hidden"),"focus",function(){e.Focus()});new i(t,e)}};BX.ready(function(){if(BX.browser.IsIE()){var e=BX.findChildren(document,{className:"reviews-post-table"},true),t,i,s;if(!e)return;for(t=0;t<e.length;t++){i=e[t].getElementsByTagName("*");s=i.length;while(s--){if(i[s].scrollWidth>i[s].offsetWidth){i[s].style["paddingBottom"]="20px";i[s].style["overflowY"]="hidden"}}}}});e.fTextToNode=function(e){var t=BX.create("div");t.innerHTML=e;if(t.childNodes.length>0)return t;else return null};e.PostFormAjaxStatus=function(t){var i=BX.findChild(document,{className:"reviews-note-box"},true,true),s;if(i)for(s=0;s<=i.length;s++)BX.remove(i[s]);var r=BX.findChild(document,{className:"reviews-block-container"},true);if(!r)return;if(t.length<1)return;var a=e.fTextToNode(t);if(!a)return;var o=["reviews-reply-form","reviews-collapse"];var n=r;while((n=n.nextSibling)&&!!n){if(n.nodeType==1){var l=false;for(s=0;s<o.length;s++){if(BX.hasClass(n,o[s])){l=true;break}}if(l){n.parentNode.insertBefore(a,n);break}}}};e.SetReviewsAjaxPostTmp=function(t){e.forumAjaxPostTmp=t};e.fReplaceOrInsertNode=function(t,i,s,r){var a=null;if(!BX.type.isDomNode(s))return false;if(!BX.type.isDomNode(t)&&!BX.type.isArray(t)&&t.length>0)if(!(t=e.fTextToNode(t)))return false;if(BX.type.isDomNode(i)){s=i.parentNode;a=i.nextSibling;s.removeChild(i)}if(!a)a=BX.findChild(s,r,true);if(a){a.parentNode.insertBefore(t,a)}else{s.appendChild(t)}return true};e.fRunScripts=function(e){var t=BX.processHTML(e,true);BX.ajax.processScripts(t.SCRIPT,true)};e.ShowLastEditReason=function(e,t){if(t){if(e)t.style.display="block";else t.style.display="none"}};e.AttachFile=function(e,t,i,s){var r=null;var a=false;e=parseInt(e);t=parseInt(t);document.getElementById("upload_files_info_"+i).style.display="block";for(var o=e;o<e+t;o++){r=document.getElementById("upload_files_"+o+"_"+i);if(!r||typeof r===null)break;if(r.style.display=="none"){a=true;r.style.display="block";break}}var n=!a?true:o>=e+t-1;if(n===true)s.style.display="none"};e.GetSelection=function(){var t,i="";if(e.getSelection){t=e.getSelection();i=t.toString()}else if(document.selection){t=document.selection;i=t.createRange().text}return i}})(window);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?159569178660303";s:6:"source";s:69:"/bitrix/components/bitrix/main.post.form/templates/.default/script.js";s:3:"min";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.min.js";s:3:"map";s:73:"/bitrix/components/bitrix/main.post.form/templates/.default/script.map.js";}"*/
(function(){if(window["LHEPostForm"])return;var e={controller:{},handler:{},form:{}};BX.addCustomEvent(window,"BFileDLoadFormControllerWasBound",function(t){e.controller[t.id]=true});BX.addCustomEvent(window,"WDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"WDLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"DiskDLoadFormControllerInit",function(t){e.controller[t.CID]=t});BX.addCustomEvent(window,"DiskLoadFormControllerWasBound",function(t){e.controller[t.CID]=true});BX.addCustomEvent(window,"OnEditorInitedBefore",function(t){if(e.handler[t.id]){t.__lhe_flags=["OnEditorInitedBefore"];if(e.handler[t.id]["params"]&&e.handler[t.id]["params"]["LHEJsObjName"])window[e.handler[t.id].params["LHEJsObjName"]]=t;e.handler[t.id].OnEditorInitedBefore(t)}});var t=function(t){if(e.handler[t.id]&&e.handler[t.id].editorIsLoaded!==true){e.handler[t.id].editorIsLoaded=true;e.handler[t.id].exec();BX.onCustomEvent(e.handler[t.id],"OnEditorIsLoaded",[e.handler[t.id],t])}};BX.addCustomEvent(window,"OnCreateIframeAfter",t);BX.addCustomEvent(window,"OnEditorInitedAfter",function(i,n){if(e.handler[i.id]){i.__lhe_flags.push("OnEditorInitedAfter");e.handler[i.id].OnEditorInitedAfter(i);if(e.handler[i.id].editorIsLoaded!==true&&n&&i.sandbox&&i.sandbox.inited)t.apply(i,[i])}});BX.util.object_search=function(e,t){for(var i in t){if(t.hasOwnProperty(i)){if(t[i]==e)return true;else if(typeof t[i]=="object"&&t[i]!==null){var n=BX.util.object_search_key(e,t[i]);if(n!==false)return n}}}return false};var i=function(e,t,i){i=i&&i.length>0?i:[];if(typeof t=="object"&&t.length>0){var n;while((n=t.pop())&&n&&t.length>0){i.push(n)}t=n}i.push(t);this.exist=true;this.bxTag=e;this.tag=t;this.tags=i;this.regexp=new RegExp("\\[("+i.join("|")+")=((?:\\s|\\S)*?)(?:\\s*?WIDTH=(\\d+)\\s*?HEIGHT=(\\d+))?\\]","ig");this.code="["+t+"=#ID##ADDITIONAL#]";this.wysiwyg='<span style="color: #2067B0; border-bottom: 1px dashed #2067B0; margin:0 2px;" id="#ID#"#ADDITIONAL#>#NAME#</span>'},n=function(t,i,n){this.CID=this.id=i;this.parser=t.parser["disk_file"]||null;this.params=n;this.node=BX("diskuf-selectdialog-"+i);this.handler=e.controller[i];this.manager=t;this.eventNode=this.manager.eventNode;this.parserName="disk_file";this.prefixNode="disk-edit-attach";this.prefixHTMLNode="disk-attach-";this.props={valueEditClassName:"wd-inline-file",securityCID:"disk-upload-cid"};this.storage="disk";this.fileToAttach={};this.xmlToAttach={};this.events={onInit:"DiskDLoadFormControllerInit",onShow:"DiskLoadFormController",onBound:"DiskLoadFormControllerWasBound"}};n.prototype={parser:false,eventNode:null,values:{},initialized:false,functionsToExec:[],exec:function(e,t){if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.handler&&this.handler!==true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},init:function(){if(this.initialized!==true){this.values={};this.functionsToExec=[];this.initialized=true;this.bindMainEvents(this.manager);if(this.parser!==null){this.bindEvents(this.manager);return this.initValues()}}return false},initValues:function(){var e=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(e&&e.length>0){this.exec(this.runCheckText);return true}return false},bindMainEvents:function(t){var i=null;BX.addCustomEvent(t.eventNode,"onReinitializeBefore",BX.proxy(this.clean,this));BX.addCustomEvent(t.eventNode,"onShowControllers",BX.proxy(function(e){i=e;BX.onCustomEvent(t.eventNode,this.events.onShow,[e])},this));if(!e.controller[this.id]){var o=BX.delegate(function(e){if(e["UID"]==this.id||e["id"]==this.id){if(i==="show"||i==="hide"){BX.onCustomEvent(t.eventNode,this.events.onShow,[i]);i=null}BX.removeCustomEvent(window,this.events.onBound,o)}},this);BX.addCustomEvent(window,this.events.onBound,o)}if(BX["DD"]&&this.storage=="disk"){var r=BX.delegate(function(e){if((e["UID"]==this.id||e["id"]==this.id)&&this.manager["dropZoneExists"]!==true){BX.removeCustomEvent(window,this.events.onBound,r);this.manager["dropZoneExists"]=true;var i=this.eventNode,o=this.id;n.dndCatcher=n.dndCatcher||{};n.dndCatcher[o]={catch:true,files:[],dropZone:null,dropZoneMicro:null,initdrag:BX.delegate(function(){n.dndCatcher[o].dropZone=new BX.DD.dropFiles(t.eventNode);BX.addCustomEvent(t.eventNode,"OnImageDataUriHandle",function(e,t){if(BX["UploaderUtils"]){var i=BX.UploaderUtils.dataURLToBlob(t.src);if(i&&i.size>0&&i.type.indexOf("image/")==0){i.name=i.name||t.title||"image."+i.type.substr(6);i.referrerToEditor=t;if(n.dndCatcher[o]["catch"]===true)n.dndCatcher[o]["drop"]([i]);else if(this.handler&&this.handler["addFile"])this.handler.addFile(i);BX.onCustomEvent(e,"OnImageDataUriCaught",[t])}}}.bind(this));BX.addCustomEvent(n.dndCatcher[o].dropZone,"dropFiles",n.dndCatcher[o]["drop"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragEnter",n.dndCatcher[o]["dragover"]);BX.addCustomEvent(n.dndCatcher[o].dropZone,"dragLeave",n.dndCatcher[o]["dragleave"]);if(BX("micro"+t.__divId)){n.dndCatcher[o].dropZoneMicro=new BX.DD.dropFiles(BX("micro"+t.__divId));BX.addCustomEvent(n.dndCatcher[o].dropZoneMicro,"dragEnter",function(){BX.onCustomEvent(t.eventNode,"OnShowLHE",["justShow"])})}BX.unbind(document,"dragover",n.dndCatcher[o]["initdrag"]);BX.onCustomEvent(t.eventNode,"onDropZoneExists",[])},this),dragover:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragover",[])},this),dragleave:BX.delegate(function(){BX.removeClass(t.eventNode,"feed-add-post-dnd-over");BX.onCustomEvent(t.eventNode,"dragleave",[])},this),dragenterwindow:BX.delegate(function(){BX.addClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.addClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragenterwindow",[])},this),dragleavewindow:BX.delegate(function(e){BX.removeClass(t.eventNode,"feed-add-post-dnd-ready");if(BX("micro"+t.__divId)){BX.removeClass(BX("micro"+t.__divId),"feed-add-post-micro-dnd-ready")}BX.onCustomEvent(t.eventNode,"dragleavewindow",[])},this),drop:BX.delegate(function(e){BX.onCustomEvent(t.eventNode,"drop",[]);BX.onCustomEvent(window,"dragWindowLeave");BX.onCustomEvent(window,"__dragWindowLeave");var i=0;if(e&&e.length>0){if(n.dndCatcher[o]["catch"]===true){n.dndCatcher[o].files=e;i=1}else{i=2}BX.onCustomEvent(t.eventNode,this.events.onShow,["show"]);BX.removeClass(t.eventNode,"feed-add-post-dnd-ready feed-add-post-dnd-over")}return i},this)};BX.ready(function(){n.dndCatcher[o]["initdrag"]()});BX.addCustomEvent(i,"OnIframeDrop",BX.delegate(function(e){BX.PreventDefault(e);if(e["dataTransfer"]&&e["dataTransfer"]["files"]){if(n.dndCatcher[o].drop(e["dataTransfer"]["files"])===2){this.handler.agent.onChange(e["dataTransfer"]["files"])}}},this));BX.addCustomEvent(i,"OnIframeDragOver",n.dndCatcher[o].dragover);BX.addCustomEvent(i,"OnIframeDragLeave",n.dndCatcher[o].dragleave);if(!window["bxMpfDndCatcher"]){window["bxMpfDndCatcher"]=true;var s=false,a=function(){if(s===false){s=true;BX.bind(document,"dragleave",l);BX.bind(document,"dragover",l);BX.bind(document,"mouseout",d);BX.onCustomEvent(window,"dragWindowEnter")}},d=function(e){BX.unbind(document,"dragleave",l);BX.unbind(document,"dragover",l);BX.unbind(document,"mouseout",d);s=false;BX.onCustomEvent(window,"dragWindowLeave")},l=function(e){if(h>0){clearTimeout(h);h=0}BX.fixEventPageXY(e);var t=true;if(e.pageX>0&&e.pageY>0){var i=BX.GetWindowSize();if(e.pageY<i.scrollHeight&&e.pageX<i.scrollWidth){var n=e.pageY-i.scrollTop,o=e.pageX-i.scrollLeft;if(0<n&&n<i.innerHeight-20&&0<o&&o<i.innerWidth-20){t=false}}}if(t){d(e)}else{h=setTimeout(function(){l({type:"intervalLimit"})},100)}},h=0;BX.bind(document,"dragenter",function(e){if(window["bxMpfDndCatcher"]>0){clearTimeout(window["bxMpfDndCatcher"])}var t=true;if(e&&e["dataTransfer"]&&e["dataTransfer"]["types"]){for(var i=0;i<e["dataTransfer"]["types"].length;i++){if(e["dataTransfer"]["types"][i]=="Files"){t=true;break}}}if(t){a()}});BX.addCustomEvent(window,"__dragWindowLeave",d);BX.bind(document,"dragover",function(e){return BX.PreventDefault(e)});BX.bind(document,"drop",function(e){d(e);return BX.PreventDefault(e)})}BX.addCustomEvent(window,"dragWindowEnter",n.dndCatcher[o].dragenterwindow);BX.addCustomEvent(window,"dragWindowLeave",n.dndCatcher[o].dragleavewindow);this.__initCatcher=BX.delegate(function(e,i){if(e==this.id){BX.removeCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher);i.agent.initDropZone(t.eventNode);if(n.dndCatcher[e].files.length>0){i.agent.onChange(n.dndCatcher[e].files);n.dndCatcher[e].files=[]}n.dndCatcher[e]["catch"]=false;this.__initCatcher=null}},this);BX.addCustomEvent(t.eventNode,"onControllerInitialized",this.__initCatcher)}},this);BX.addCustomEvent(window,this.events.onBound,r);if(e.controller[this.id])r(e.controller[this.id])}},bindEvents:function(e){this._catchHandler=BX.delegate(function(t){BX.removeCustomEvent(this.eventNode,this.events.onInit,this._catchHandler);this.handler=t;var i=BX.findChild(BX(e.formID),{attr:{id:this.props.securityCID}},true,false);if(i)i.value=this.handler.CID;this.exec();var n=BX.delegate(function(){BX.onCustomEvent(e.eventNode,"onUploadsHasBeenChanged",arguments)},this);BX.addCustomEvent(this.handler.agent,"onFileIsInited",n);BX.addCustomEvent(this.handler.agent,"ChangeFileInput",n);BX.onCustomEvent(e.eventNode,"onControllerInitialized",[this.id,t])},this);if(typeof this.handler!="object"||!this.handler)BX.addCustomEvent(e.eventNode,this.events.onInit,this._catchHandler);else this._catchHandler(this.handler);BX.addCustomEvent(e.eventNode,"OnFileUploadSuccess",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){i=i||{};i.usePostfix=true;this.addFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadFailed",BX.delegate(function(e,t,i){if(this.id==t.CID||this.id==t.id){this.failFile(e,i,t)}},this));BX.addCustomEvent(e.eventNode,"OnFileUploadRemove",BX.delegate(function(e,t){if(this.id==t.CID||this.id==t.id){this.deleteFile(e,{usePostfix:true},t)}},this));BX.addCustomEvent(this,"onFileIsInText",BX.proxy(function(e,t){this.adjustFile(this.checkFile(e),t)},this))},addFile:function(e,t,i){var n=this.checkFile(e.element_id,e,t);if(n){setTimeout(BX.proxy(function(){this.bindFile(n);this.adjustFile(n,false)},this),100);BX.onCustomEvent(this.eventNode,"onFileIsAdded",[n,this,i,t])}else{this.failFile(this,t,i)}return true},failFile:function(e,t,i){BX.onCustomEvent(this.eventNode,"onFileIsFailed",[this,i,t])},checkFile:function(e,t){e=""+(typeof e=="object"?e.id:e);if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(t.place)){var i={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(t.place,true),xmlID:BX(t.place,true).getAttribute("bx-attach-xml-id"),fileID:BX(t.place,true).getAttribute("bx-attach-file-id"),fileType:BX(t.place,true).getAttribute("bx-attach-file-type")},n;if(/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name)&&(n=BX.findChild(i.place,{className:"files-preview",tagName:"IMG"},true,false))&&n){i.type="image/xyz";i.lowsrc=n.src;i.element_url=i.src=n.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight=(\d+)/,"");i.isImage=true;i.width=parseInt(n.getAttribute("data-bx-full-width")||n.getAttribute("data-bx-width"));i.height=parseInt(n.getAttribute("data-bx-full-height")||n.getAttribute("data-bx-height"))}if(i.xmlID)this.xmlToAttach[i.xmlID+""]=e;if(i.fileID)this.fileToAttach[i.fileID+""]=e;this.values[e]=i}return this.values[e]||false},bindFile:function(e){var t=e.place;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){var i=BX.findChild(t,{className:"f-wrap"},true,false),n=BX.findChild(t,{className:"files-preview"},true,false);if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e.id)},this));i.style.cursor="pointer";i.title=BX.message("MPF_FILE")}if(n){BX.bind(n,"click",BX.delegate(function(){this.insertFile(e.id)},this))}}},adjustFile:function(e,t){var i=e.place;if(t===true||t===false){if(!e.info)e.info=BX.findChild(e.place,{className:"files-info"},true,false);i=e.info;if(BX.type.isDomNode(i)){var n="check-in-text-"+e.id,o=BX(n),r=t===false?{attrs:{"bx-file-is-in-text":"N"},props:{className:"insert-btn"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_INSERT_IN_TEXT")+"</span>"}:{attrs:{"bx-file-is-in-text":"Y"},props:{className:"insert-text"},html:'<span class="insert-btn-text">'+BX.message("MPF_FILE_IN_TEXT")+"</span>"};if(!o){r.attrs.id=n;r.events={click:BX.proxy(function(){this.insertFile(e.id)},this)};i.appendChild(BX.create("SPAN",r))}else{BX.adjust(o,r)}}}},insertFile:function(e){BX.onCustomEvent(this.eventNode,"onFileIsInserted",[this.checkFile(e),this])},deleteFile:function(e,t){e=this.checkFile(e,t);if(e){BX.onCustomEvent(this.eventNode,"onFileIsDeleted",[e,this]);this.values[e.id].place=null;delete this.values[e.id].place;this.values[e.id]=null;delete this.values[e.id];e=null;return true}return false},reinitValues:function(e,t){var i,n,o={};while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("data-bx-title")||n.getAttribute("data-title"),size:n.getAttribute("data-bx-size")||"",sizeInt:n.getAttribute("data-bx-size")||"",width:n.getAttribute("data-bx-width"),height:n.getAttribute("data-bx-height"),storage:"disk",previewUrl:n.tagName=="A"?"":n.getAttribute("data-bx-src")||n.getAttribute("data-src"),fileId:n.getAttribute("bx-attach-file-id")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");if(n.hasAttribute("bx-attach-file-type"))o["E"+i]["fileType"]=n.getAttribute("bx-attach-file-type")}}this.handler.selectFile({},{},o);this.runCheckText()},runCheckText:function(){if(!this._checkText)this._checkText=BX.delegate(this.checkText,this);this.manager.exec(this._checkText)},checkText:function(){var e,t=this.manager.getContent(),i=[],n,o;if(t!=""){e=t;for(o in this.xmlToAttach){if(this.xmlToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]").replace(new RegExp("\\[DOCUMENT ID=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.xmlToAttach[o]+"$2]")}}for(o in this.fileToAttach){if(this.fileToAttach.hasOwnProperty(o)){t=t.replace(new RegExp("\\&\\#91\\;"+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\&\\#93\\;","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]").replace(new RegExp("\\["+this.parser["tag"]+"=("+o+")([WIDTHHEIGHT=0-9 ]*)\\]","gim"),"["+this.parser["tag"]+"="+this.fileToAttach[o]+"$2]")}}n=new RegExp("(?:\\&\\#91\\;)("+this.parser["tags"].join("|")+")=([a-z=0-9 ]+)(?:\\&\\#93\\;)","gim");if(n.test(t)){for(o in this.values){if(this.values.hasOwnProperty(o)){i.push(o)}}if(i.length>0){n=new RegExp("(?:\\&\\#91\\;|\\[)("+this.parser["tags"].join("|")+")=("+i.join("|")+")([WIDTHHEIGHT=0-9 ]*)(?:\\&\\#93\\;|\\])","gim");if(n.test(t))t=t.replace(n,BX.delegate(function(e,t,i,n){return"["+t+"="+i+n+"]"},this))}}if(e!=t)BX.onCustomEvent(this.eventNode,"onFileIsDetected",[t,this])}return t},clean:function(){if(this.handler&&this.handler.values){var e,t,i,n=BX(this.manager.formID);while((e=this.handler.values.pop())&&e){BX.remove(e)}if(this.handler.params&&this.handler.params.controlName){t=BX.findChildren(n,{tagName:"INPUT",attribute:{name:this.handler.params.controlName}},true)}if(t){for(i=0;i<t.length;i++){BX.remove(t[i])}}}},reinit:function(e,t){var i=[],n,o;for(n in t){if(t.hasOwnProperty(n)){if(t[n]["USER_TYPE_ID"]==this.parserName&&t[n]["VALUE"]){for(o in t[n]["VALUE"]){if(t[n]["VALUE"].hasOwnProperty(o)){i.push(t[n]["VALUE"][o])}}}}}if(i.length>0){this.exec(this.reinitValues,[e,i]);return true}return false}};var o=function(e,t,i){o.superclass.constructor.apply(this,arguments);this.parser=e.parser["webdav_element"]||null;this.node=BX("wduf-selectdialog-"+t);this.manager=e;this.parserName="webdav_element";this.prefixNode="wd-doc";this.prefixHTMLNode="wdif-doc-";this.storage="webdav";this.events={onInit:"WDLoadFormControllerInit",onShow:"WDLoadFormController",onBound:"WDLoadFormControllerWasBound"}};BX.extend(o,n);o.prototype.reinitValues=function(e,t){var i,n,o={};this.waitAnswerFromServer=[];while((i=t.pop())&&i){n=BX(this.prefixHTMLNode+i);n=n?n.tagName=="A"?n:BX.findChild(n,{tagName:"IMG"},true):null;if(n){o["E"+i]={type:"file",id:i,name:n.getAttribute("alt"),storage:"webdav",size:n.getAttribute("data-bx-size"),sizeInt:1,ext:"",link:n.getAttribute("data-bx-document")};if(n.hasAttribute("bx-attach-xml-id"))o["E"+i]["xmlId"]=n.getAttribute("bx-attach-xml-id");this.waitAnswerFromServer.push(i)}}if(this.waitAnswerFromServer.length>0){if(!this._defferCheckText)this._defferCheckText=BX.delegate(this.defferCheckText,this);BX.addCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText);this.handler.WDFD_SelectFile({},{},o)}};o.prototype.defferCheckText=function(e){var t=BX.util.array_search(e.element_id,this.waitAnswerFromServer);if(t>=0){this.runCheckText();this.waitAnswerFromServer=BX.util.deleteFromArray(this.waitAnswerFromServer,t)}if(this.waitAnswerFromServer.length<=0)BX.removeCustomEvent(this.eventNode,"OnFileUploadSuccess",this._defferCheckText)};var r=function(e,t,i){r.superclass.constructor.apply(this,arguments);this.parser=e.parser["file"]?e.parser["file"]:e.parser["postimage"]["exist"]?e.parser["postimage"]:null;this.postfix=i["postfix"]||"";this.node=BX("file-selectdialog-"+t);this.parserName="file";this.prefixNode="wd-doc";this.prefixHTMLNode="file-doc-";this.props={valueEditClassName:"file-inline-file",securityCID:"upload-cid"};this.storage="bfile";this.events={onInit:"BFileDLoadFormControllerInit",onShow:"BFileDLoadFormController",onBound:"BFileDLoadFormControllerWasBound"}};BX.extend(r,n);r.prototype.initValues=function(e){var t;if(e!==true){t=BX.findChildren(this.node,{className:this.props.valueEditClassName},true);if(t&&t.length>1){this.exec(this.initValues,[true]);return true}return false}t=this.handler.agent.values||[];var i,n,o,r,s={},a="/bitrix/components/bitrix/main.file.input/file.php?mfi_mode=down&cid="+this.handler.CID+"&sessid="+BX.bitrix_sessid();for(var d=0;d<t.length;d++){r=parseInt(t[d].getAttribute("id").replace(this.prefixNode,""));if(s["id"+r])continue;s["id"+r]="Y";if(r>0){n=BX.findChild(t[d],{className:"f-wrap"},true,false);if(!n)continue;o={element_id:r,element_name:n.innerHTML,parser:this.parser.bxTag,storage:"bfile",element_url:a+"&fileID="+r};i=this.addFile(o,{usePostfix:true,hasPreview:false})}}this.runCheckText();return true};r.prototype.checkFile=function(e,t,i){e=""+(typeof e=="object"?e.id:e);e=e+(i&&i["usePostfix"]===true?this.postfix:"");if(typeof t=="object"&&t!==null&&e&&t.element_name&&BX(this.prefixNode+t.element_id,true)){var n={id:e,name:t.element_name,url:t.element_url,type:"isnotimage/xyz",isImage:false,place:BX(this.prefixNode+t.element_id,true)},o;if((t["element_type"]&&t["element_type"].indexOf("image/")===0||/(\.png|\.jpg|\.jpeg|\.gif|\.bmp)$/i.test(t.element_name))&&((o=BX.findChild(n.place,{tagName:"IMG"},true,false))&&o||i&&i["hasPreview"]===false)){n.type="image/xyz";n.src=t["element_thumbnail"]||t["element_url"];n.isImage=true;n.hasPreview=false;n.lowsrc="";n.width="";n.height="";if(BX(o)){n.hasPreview=true;n.lowsrc=t["element_thumbnail"]||o["src"];n.width=parseInt(o.getAttribute("data-bx-full-width"));n.height=parseInt(o.getAttribute("data-bx-full-height"))}}else if(this.parser.bxTag=="postimage"){return false}if(BX(n.place,true).getAttribute("bx-attach-file-type")){n.fileType=BX(n.place,true).getAttribute("bx-attach-file-type")}this.values[e]=n}return this.values[e]||false};r.prototype.bindFile=function(e){var t=e&&e["place"]?e["place"]:null;if(typeof e=="object"&&t&&!t.hasAttribute("bx-file-is-bound")){if(e.isImage&&e.hasPreview){var i=BX.findChild(t,{className:"feed-add-img-title"},true,false),n=BX.findChild(t,{className:"feed-add-img-wrap"},true,false);if(n){BX.bind(n,"click",BX.proxy(function(){this.insertFile(e)},this));n.style.cursor="pointer";n.title=BX.message("MPF_IMAGE")}if(i){BX.bind(i,"click",BX.delegate(function(){this.insertFile(e)},this));i.style.cursor="pointer";i.title=BX.message("MPF_IMAGE")}}else r.superclass.bindFile.apply(this,arguments)}};r.prototype.clean=function(){r.superclass.clean.apply(this,arguments);if(this["handler"]&&this.handler["agent"]&&this.handler.agent["inputName"]){var e,t,i=BX(this.manager.formID);e=BX.findChildren(i,{tagName:"INPUT",attribute:{name:this.handler.agent.inputName+"[]"}},true);if(e){for(t=0;t<e.length;t++){BX.remove(e[t])}}}};var s=function(t,i){this.params=i;this.formID=t;this.showPinButton=!!BX("lhe_button_editor_"+this.formID);if(this.showPinButton){this.params.showPanelEditor=!!this.params.pinEditorPanel}this.oEditorId=i["LHEJsObjId"];this.__divId=i["LHEJsObjName"]||i["LHEJsObjId"];e.handler[this.oEditorId]=this;e.form[this.formID]=this;this.oEditor=s.getEditor(this.oEditorId);this.urlPreview=this.initUrlPreview(i);this.eventNode=BX("div"+this.__divId);BX.addCustomEvent(this.eventNode,"OnShowLHE",BX.delegate(this.OnShowLHE,this));BX.addCustomEvent(this.eventNode,"OnButtonClick",BX.delegate(this.OnButtonClick,this));BX.addCustomEvent(this.eventNode,"OnAfterShowLHE",function(e,t){if(t.oEditor&&t.oEditor["AllowBeforeUnloadHandler"])t.oEditor.AllowBeforeUnloadHandler();if(t.monitoringWakeUp===true)t.monitoringStart()});BX.addCustomEvent(this.eventNode,"OnAfterHideLHE",function(e,t){t.monitoringWakeUp=t.monitoringStop();if(t.oEditor&&t.oEditor["DenyBeforeUnloadHandler"])t.oEditor.DenyBeforeUnloadHandler()});this.initParsers(i);this.initFiles(t,i);BX.ready(BX.delegate(function(){if(BX("lhe_button_submit_"+t,true)){BX.bind(BX("lhe_button_submit_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["submit"]);return BX.PreventDefault(e)},this))}if(BX("lhe_button_cancel_"+t,true)){BX.bind(BX("lhe_button_cancel_"+t,true),"click",BX.proxy(function(e){BX.onCustomEvent(this.eventNode,"OnButtonClick",["cancel"]);return BX.PreventDefault(e)},this))}},this));this.inited=true;if(BX(this.formID)){BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){e.FORM.setAttribute("bx-lhe-autosave-prepared","Y")})}BX.onCustomEvent(this,"onInitialized",[this,t,i,this.parsers]);BX.onCustomEvent(this.eventNode,"onInitialized",[this,t,i,this.parsers]);if(this.oEditor&&this.oEditor.inited&&!this.oEditor["__lhe_flags"]){BX.onCustomEvent(this.oEditor,"OnEditorInitedBefore",[this.oEditor]);BX.onCustomEvent(this.oEditor,"OnEditorInitedAfter",[this.oEditor,true])}};s.prototype={editorIsLoaded:false,arFiles:{},parser:{},controllers:{},exec:function(e,t){this.functionsToExec=this.functionsToExec||[];if(typeof e=="function")this.functionsToExec.push([e,t]);if(this.editorIsLoaded===true){var i;while((i=this.functionsToExec.shift())&&i)i[0].apply(this,i[1])}},initParsers:function(e){this.parser={postimage:{exist:false,bxTag:"postimage",tag:"IMG ID",tags:["IMG ID"],regexp:/\[(IMG ID)=((?:\s|\S)*?)(?:\s*?WIDTH=(\d+)\s*?HEIGHT=(\d+))?\]/gi,code:"[IMG ID=#ID##ADDITIONAL#]",wysiwyg:'<img id="#ID#" src="'+'#SRC#" lowsrc="'+'#LOWSRC#" title=""#ADDITIONAL# />'},player:{exist:false,bxTag:"player",tag:"FILE ID",tags:["FILE ID"],regexp:/\[(FILE ID)=((?:\s|\S)*?)?\]/gi,code:"[FILE ID=#ID##ADDITIONAL#]",wysiwyg:'<img class="bxhtmled-player-surrogate" id="#ID#" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" contenteditable="false" title=""#ADDITIONAL# />'}};var t=e["parsers"]?e["parsers"]:{};for(var n in t){if(t.hasOwnProperty(n)&&/[a-z]/gi.test(n+"")){this.parser[n]=new i(n,t[n])}}if(BX.util.object_search("UploadImage",t)){this.parser["postimage"]["exist"]=true}if(typeof e["arSize"]=="object"){var o="";if(e["arSize"]["width"])o+="max-width:"+e["arSize"]["width"]+"px;";if(e["arSize"]["height"])o+="max-height:"+e["arSize"]["height"]+"px;";if(o!=="")this.parser["postimage"]["wysiwyg"]=this.parser["postimage"]["wysiwyg"].replace("#ADDITIONAL#",' style="'+o+'" #ADDITIONAL#')}},initFiles:function(e,t){this.arFiles={};this.controllers={common:{postfix:"",storage:"bfile",parser:"postimage",node:window,obj:null,init:false}};this.monitoring={interval:null,text:"",savedText:"",files:[],savedFiles:[]};if(!t["CID"]||typeof t["CID"]!=="object")return;BX.addCustomEvent(this.eventNode,"onFileIsAdded",BX.delegate(this.OnFileUploadSuccess,this));BX.addCustomEvent(this.eventNode,"onFileIsFailed",BX.delegate(this.OnFileUploadFailed,this));BX.addCustomEvent(this.eventNode,"onFileIsDeleted",BX.delegate(this.OnFileUploadRemove,this));BX.addCustomEvent(this.eventNode,"onFileIsDetected",BX.delegate(this.setContent,this));BX.addCustomEvent(this.eventNode,"onFileIsInserted",BX.delegate(this.insertFile,this));var i,s,a;for(s in t["CID"]){if(t["CID"].hasOwnProperty(s)){i=t["CID"][s]["parser"];if(i=="disk_file")this.controllers[s]=new n(this,s,t["CID"][s]);else if(i=="webdav_element")this.controllers[s]=new o(this,s,t["CID"][s]);else if(i=="file")this.controllers[s]=new r(this,s,t["CID"][s]);if(this.controllers[s]&&this.controllers[s].init()&&!a)a=true}}BX.ready(BX.delegate(function(){BX.bind(BX("bx-b-uploadfile-"+e),"click",BX.proxy(this.controllerInit,this));if(a)this.controllerInit("show")},this))},controllerInit:function(e){this.controllerInitStatus=e=="show"||e=="hide"?e:this.controllerInitStatus=="show"?"hide":"show";BX.onCustomEvent(this.eventNode,"onShowControllers",[this.controllerInitStatus])},initUrlPreview:function(){if(this.params["urlPreviewId"]&&window["BXUrlPreview"]&&BX(this.params["urlPreviewId"])){return new BXUrlPreview(BX(this.params["urlPreviewId"]))}return null},getContent:function(){return this.oEditor?this.oEditor.GetContent():""},setContent:function(e){if(this.oEditor)this.oEditor.SetContent(e)},OnFileUploadSuccess:function(e,t,i,n){if(this.controllers[t.id]){var o=t.parser.bxTag+e.id;this.arFiles[o]=this.arFiles[o]||[];this.arFiles[o].push(t.id);if(n&&n["referrerToEditor"]){var r=this.getFileToInsert(e,t);BX.onCustomEvent(n["referrerToEditor"],"OnImageDataUriCaughtUploaded",[r]);BX.onCustomEvent(this.oEditor,"OnImageDataUriCaughtUploaded",[n["referrerToEditor"],e,r])}else if(i===true&&e.isImage&&this.insertImageAfterUpload){if(!this._insertFile)this._insertFile=BX.delegate(this.insertFile,this);this.exec(this._insertFile,arguments)}}},OnFileUploadFailed:function(e,t,i){if(i&&i["referrerToEditor"]){BX.onCustomEvent(i["referrerToEditor"],"OnImageDataUriCaughtFailed",[]);BX.onCustomEvent(this.editor,"OnImageDataUriCaughtFailed",[i["referrerToEditor"]])}},OnFileUploadRemove:function(e,t){if(this.controllers[t.id]){var i=t.parser.bxTag+e.id;if(this.arFiles[i]){var n=BX.util.array_search(t.id,this.arFiles[i]);this.arFiles[i]=BX.util.deleteFromArray(this.arFiles[i],n);if(!this.arFiles[i]||this.arFiles[i].length<=0){this.arFiles[i]=null;delete this.arFiles[i];if(!this._deleteFile)this._deleteFile=BX.delegate(this.deleteFile,this);this.exec(this._deleteFile,arguments)}}}},showPanelEditor:function(e,t){if(e==undefined)e=!this.oEditor.toolbar.IsShown();this.params.showPanelEditor=e;var i=BX("lhe_button_editor_"+this.formID),n=BX("panel-close"+this.__divId);if(n){this.oEditor.dom.cont.appendChild(n)}if(e){this.oEditor.dom.toolbarCont.style.opacity="inherit";this.oEditor.toolbar.Show();if(i)BX.addClass(i,"feed-add-post-form-btn-active");if(n)n.style.display=""}else{this.oEditor.toolbar.Hide();if(i)BX.removeClass(i,"feed-add-post-form-btn-active");if(n)n.style.display="none"}if(t!==false)BX.userOptions.save("main.post.form","postEdit","showBBCode",e?"Y":"N")},monitoring:{},monitoringStart:function(){if(this.monitoring.interval===null){if(!this._monitoringStart){this._monitoringStart=BX.delegate(this.checkFilesInText,this);BX.addCustomEvent(this.oEditor,"OnContentChanged",BX.proxy(function(e){this.monitoring.text=e},this))}this.monitoring.interval=setInterval(this._monitoringStart,1e3)}},monitoringStop:function(){var e=this.monitoring.interval!==null;if(this.monitoring.interval!==null)clearInterval(this.monitoring.interval);this.monitoring.interval=null;return e},monitoringSetStatus:function(e,t,i){if(this.arFiles[e+t]){var n;for(var o=0;o<this.arFiles[e+t].length;o++){n=this.arFiles[e+t][o];BX.onCustomEvent(this.controllers[n],"onFileIsInText",[t,i])}}},checkFilesInText:function(){if(this.monitoring.text!==this.monitoring.savedText){this.monitoring.savedText=this.monitoring.text;this.monitoring.files=[];var e=this.monitoring.savedText,t,i=function(e,t){return function(i,n,o){e.monitoring.files.push([t,o].join("/"))}};for(t in this.parser){if(this.parser.hasOwnProperty(t)){if(!this.parser[t]["checkFilesInText"]){this.parser[t]["checkFilesInText"]=i(this,t)}e.replace(this.parser[t]["regexp"],this.parser[t]["checkFilesInText"])}}if(this.monitoring.savedFiles.join(",")!==this.monitoring.files.join(",")){var n={},o;while(o=this.monitoring.savedFiles.pop()){n[o]=null}for(t=0;t<this.monitoring.files.length;t++){o=this.monitoring.files[t];n[o]=n[o]>=0?n[o]+1:1}for(t in n){if(n.hasOwnProperty(t)){o=t.split("/");this.monitoringSetStatus(o[0],o[1],n[t]>0)}}}this.monitoring.savedFiles=this.monitoring.files;if(this.monitoring.savedFiles.length<=0)this.monitoringStop()}},checkFile:function(e,t){var i=false;if(typeof e=="string"){var n=typeof t=="string"?t:t.parser;if(!!this.arFiles[n+e]){var o=this.arFiles[n+e][0];t=this.controllers[o];i={file:t.values[e],controller:t}}}else if(this.controllers[t.id]){i={file:e,controller:t}}return i},insertFile:function(e,t){var i=this.oEditor;if(i&&e){var n=i.GetViewMode(),o=this.getFileToInsert(e,t);if(n=="wysiwyg"){i.InsertHtml(o.replacement);setTimeout(BX.delegate(i.AutoResizeSceleton,i),500);setTimeout(BX.delegate(i.AutoResizeSceleton,i),1e3)}else if(n=="code"){i.textareaView.Focus();if(!i.bbCode){var r=i.GetIframeDoc();var s=r.createElement("DIV");s.style.display="none";s.innerHTML=o.replacement;r.body.appendChild(s);o.replacement=i.Parse(o.replacement,true,false);s.parentNode.removeChild(s)}i.textareaView.WrapWith("","",o.replacement)}else{return}o["callback"]()}},getFileToInsert:function(e,t){var i=this.oEditor;if(i&&e){var n=e["id"],o="",r=t.parser,s=i.bbCode?i.GetViewMode():"wysiwyg",a=this.parser[r.bxTag][s];if(e["fileType"]&&this.parser[e["fileType"]]&&s=="wysiwyg"){a=this.parser[e["fileType"]][s]}if(e["isImage"]){a=s=="wysiwyg"?this.parser["postimage"][s]:a;if(e.width>0&&e.height>0&&i.sEditorMode=="html"){o=' style="width:'+e.width+"px;height:"+e.height+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}if(s=="wysiwyg"){a=a.replace("#ID#",i.SetBxTag(false,{tag:r.bxTag,params:{value:n}})).replace("#SRC#",e.src).replace("#URL#",e.url).replace("#LOWSRC#",e.lowsrc||"").replace("#NAME#",e.name).replace("#ADDITIONAL#",o)+"<span>&nbsp;</span>"}else if(s=="code"&&i.bbCode){a=a.replace("#ID#",n).replace("#ADDITIONAL#","")}return{replacement:a,callback:BX.proxy(function(){this.monitoringSetStatus(t.parser.bxTag,e.id,true);this.monitoringStart()},this)}}return{replacement:"",callback:BX.DoNothing}},deleteFile:function(e,t){var i=this.oEditor,n=t.parser,o=e.id,r=i.GetContent();if(n&&r.indexOf("="+o)>=0){if(i.GetViewMode()=="wysiwyg"){var s=i.GetIframeDoc(),a,d;for(a in i["bxTags"]){if(i["bxTags"].hasOwnProperty(a)){if(typeof i.bxTags[a]=="object"&&i.bxTags[a]["params"]&&i.bxTags[a]["params"]["value"]==e.id){d=s.getElementById(a);if(d)d.parentNode.removeChild(d)}}}i.SaveContent()}else{r=r.replace(n.regexp,function(t,i,n){return n==e.id?"":t});i.SetContent(r);i.Focus()}this.monitoringSetStatus(n.bxTag,e.id,false)}},reinit:function(e,t){BX.onCustomEvent(this.eventNode,"onReinitializeBefore",[this,e,t]);this.arFiles={};delete this.monitoringWakeUp;this.monitoringStop();this.oEditor.CheckAndReInit(e||"");BX.onCustomEvent(this.eventNode,"onReinitialize",[this,e,t]);var i,n=false;for(i in this.controllers){if(this.controllers.hasOwnProperty(i)){if(this.controllers[i]["init"]&&this.controllers[i].reinit(e,t))n=true}}this.controllerInit(n?"show":"hide");if(this.params["~height"]){this.oEditor.SetConfigHeight(this.params["~height"]);this.oEditor.ResizeSceleton()}if(this.urlPreview){this.urlPreview.detachUrlPreview();var o;for(var r in t){if(t.hasOwnProperty(r)&&t[r].hasOwnProperty("USER_TYPE_ID")&&t[r]["USER_TYPE_ID"]==="url_preview"){o=t[r]["VALUE"]}}if(o)this.urlPreview.attachUrlPreview({id:o})}},Parse:function(e,t,i){var n=this.parser[e],o=this;if(n){t=t.replace(n.regexp,function(t,r,s,a,d){var l=o.checkFile(s,e);if(l&&(l=l.file)&&l){var h="",f=l.isImage?o.parser.postimage.wysiwyg:n.wysiwyg;o.monitoringStart();if(l.fileType&&o.parser[l.fileType]&&o.parser[l.fileType].wysiwyg){f=o.parser[l.fileType].wysiwyg}if(l.isImage){a=parseInt(a);d=parseInt(d);h=a&&d?' width="'+a+'" height="'+d+'"':"";if(h===""&&l["width"]>0&&l["height"]>0){h=' style="width:'+l["width"]+"px;height:"+l["height"]+"px;\" onload=\"this.style.width='auto';this.style.height='auto';\""}}return f.replace("#ID#",i.SetBxTag(false,{tag:e,params:{value:s}})).replace("#NAME#",l.name).replace("#SRC#",l.src).replace("#LOWSRC#",l.lowsrc).replace("#ADDITIONAL#",h).replace("#WIDTH#",parseInt(a)).replace("#HEIGHT#",parseInt(d))}return t})}return t},Unparse:function(e,t){var i="",n=e.tag;if(this.parser[n]){var o=parseInt(t.node.hasAttribute("width")?t.node.getAttribute("width"):0),r=parseInt(t.node.hasAttribute("height")?t.node.getAttribute("height"):0),s="";if(o>0&&r>0){s=" WIDTH="+o+" HEIGHT="+r}i=this.parser[n]["code"].replace("#ID#",e.params.value).replace("#ADDITIONAL#",s).replace("#WIDTH#",o).replace("#HEIGHT#",r)}return i},OnShowLHE:function(e,t,i){var n=this.__divId;e=e===false?false:e==="hide"?"hide":e==="justShow"?"justShow":true;this.oEditor=this.oEditor||s.getEditor(this.oEditorId);if(!this.oEditor)return;this.oEditor.Init();var o=BX("micro"+n),r=this.eventNode;if(o){o.style.display=e===true||e==="justShow"?"none":"block"}if(e=="hide"){BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);if(this.eventNode.style.display=="none"){BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}else{new BX["easing"]({duration:200,start:{opacity:100,height:this.eventNode.scrollHeight},finish:{opacity:0,height:20},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.proxy(function(){this.eventNode.style.cssText="";this.eventNode.style.display="none";BX.onCustomEvent(r,"OnAfterHideLHE",[e,this])},this)}).animate()}}else if(e){BX.onCustomEvent(this.eventNode,"OnBeforeShowLHE",[e,this]);if(e=="justShow"){this.eventNode.style.display="block";BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else if(this.eventNode.style.display=="block"){BX.onCustomEvent(this.eventNode,"OnAfterShowLHE",[e,this]);if(i!==false)this.oEditor.Focus()}else{BX.adjust(this.eventNode,{style:{display:"block",overflow:"hidden",height:"20px",opacity:.1}});new BX["easing"]({duration:200,start:{opacity:10,height:20},finish:{opacity:100,height:r.scrollHeight},transition:BX["easing"].makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.proxy(function(){BX.onCustomEvent(r,"OnAfterShowLHE",[e,this]);this.oEditor.Focus();this.eventNode.style.cssText=""},this)}).animate()}}else{BX.onCustomEvent(this.eventNode,"OnBeforeHideLHE",[e,this]);this.eventNode.style.display="none";BX.onCustomEvent(this.eventNode,"OnAfterHideLHE",[e,this])}},OnButtonClick:function(e){if(e!=="cancel"){var t={result:true};BX.onCustomEvent(this.eventNode,"OnClickBeforeSubmit",[this,t]);if(t["result"]!==false)BX.onCustomEvent(this.eventNode,"OnClickSubmit",[this])}else{d.node=null;BX.onCustomEvent(this.eventNode,"OnClickCancel",[this]);BX.onCustomEvent(this.eventNode,"OnShowLHE",["hide"])}},OnEditorInitedBefore:function(e){var t=this;this.oEditor=e;e.formID=this.formID;if(this.params)this.params["~height"]=e.config["height"];BX.addCustomEvent(e,"OnCtrlEnter",function(){e.SaveContent();if(BX.type.isNotEmptyString(t.params["ctrlEnterHandler"])&&typeof window[t.params["ctrlEnterHandler"]]=="function")window[t.params["ctrlEnterHandler"]]();else if(BX.type.isFunction(t.params["ctrlEnterHandler"]))t.params["ctrlEnterHandler"]();else BX.submit(BX(t.formID))});var i=this.params.parsers?this.params.parsers:[];if(BX.util.object_search("Spoiler",i)){e.AddButton({id:"spoiler",name:BX.message("spoilerText"),iconClassName:"spoiler",disabledForTextarea:false,src:BX.message("MPF_TEMPLATE_FOLDER")+"/images/lhespoiler.png",toolbarSort:205,handler:function(){var e=this,t=false;if(!e.editor.bbCode||!e.editor.synchro.IsFocusedOnTextarea()){t=e.editor.action.actions.formatBlock.exec("formatBlock","blockquote","bx-spoiler",false,{bxTagParams:{tag:"spoiler"}})}else{t=e.editor.action.actions.formatBbCode.exec("quote",{tag:"SPOILER"})}return t}});e.AddParser({name:"spoiler",obj:{Parse:function(e,t,i){if(/\[(cut|spoiler)(([^\]])*)\]/gi.test(t)){t=t.replace(/[\001-\006]/gi,"").replace(/\[cut(((?:=)[^\]]*)|)\]/gi,"\x01$1\x01").replace(/\[\/cut]/gi,"\x02").replace(/\[spoiler([^\]]*)\]/gi,"\x03$1\x03").replace(/\[\/spoiler]/gi,"\x04");var n=/(?:\001([^\001]*)\001)([^\001-\004]+)\002/gi,o=/(?:\003([^\003]*)\003)([^\001-\004]+)\004/gi,r=function(e,t){e=e.replace(/^(="|='|=)/gi,"").replace(/("|')?$/gi,"");return'<blockquote class="bx-spoiler" id="'+i.SetBxTag(false,{tag:"spoiler"})+'" title="'+e+'">'+t+"</blockquote>"},s=function(e,t,i){return r(t,i)};while(t.match(n)||t.match(o)){t=t.replace(n,s).replace(o,s)}}t=t.replace(/\001([^\001]*)\001/gi,"[cut$1]").replace(/\003([^\003]*)\003/gi,"[spoiler$1]").replace(/\002/gi,"[/cut]").replace(/\004/gi,"[/spoiler]");return t},UnParse:function(t,i){if(t.tag=="spoiler"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[SPOILER"+(i.node.hasAttribute("title")?"="+i.node.getAttribute("title"):"")+"]"+n+"[/SPOILER]"}return""}}})}if(BX.util.object_search("MentionUser",i)){e.AddParser({name:"postuser",obj:{Parse:function(t,i){i=i.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(t,i,n){n=BX.util.trim(n);if(n=="")return"";return'<span id="'+e.SetBxTag(false,{tag:"postuser",params:{value:parseInt(i)}})+'" class="bxhtmled-metion">'+n+"</span>"});return i},UnParse:function(t,i){if(t.tag=="postuser"){var n="",o;for(o=0;o<i.node.childNodes.length;o++){n+=e.bbParser.GetNodeHtml(i.node.childNodes[o])}n=BX.util.trim(n);if(n!="")return"[USER="+t.params.value+"]"+n+"[/USER]"}return""}}})}var n=function(i,n){return t.Parse(i,n,e)},o=function(e,i){return t.Unparse(e,i)};for(var r in this.parser){if(this.parser.hasOwnProperty(r)){e.AddParser({name:r,obj:{Parse:n,UnParse:o}})}}if(this.showPinButton){this.pinEditorPanel=this.params&&this.params.pinEditorPanel===true;var s="toolbar_pin";var a=function(e,i){a.superclass.constructor.apply(this,arguments);this.id=s;this.title=BX.message("MPF_PIN_EDITOR_PANNEL");this.className+=" "+(t.pinEditorPanel?"bxhtmled-button-toolbar-pined":"bxhtmled-button-toolbar-pin");this.Create();if(i)i.appendChild(this.GetCont())};BX.extend(a,window.BXHtmlEditor.Button);a.prototype.OnClick=function(){BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pined");BX.removeClass(this.pCont,"bxhtmled-button-toolbar-pin");if(t.pinEditorPanel){t.pinEditorPanel=false;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pin")}else{t.pinEditorPanel=true;BX.addClass(this.pCont,"bxhtmled-button-toolbar-pined")}BX.userOptions.save("main.post.form","postEdit","pinEditorPanel",t.pinEditorPanel?"Y":"N")};window.BXHtmlEditor.Controls[s]=a;BX.addCustomEvent(e,"GetControlsMap",function(e){e.push({id:s,compact:true,hidden:false,sort:500,checkWidth:true,offsetWidth:32,wrap:"right"})})}},OnEditorInitedAfter:function(t){BX.addCustomEvent(t,"OnIframeDrop",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDrop",arguments)},this));BX.addCustomEvent(t,"OnIframeDragOver",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragOver",arguments)},this));BX.addCustomEvent(t,"OnIframeDragLeave",BX.proxy(function(){BX.onCustomEvent(this.eventNode,"OnIframeDragLeave",arguments)},this));BX.addCustomEvent(t,"OnImageDataUriHandle",function(){BX.onCustomEvent(this.eventNode,"OnImageDataUriHandle",Array.prototype.slice.call(arguments))}.bind(this));BX.addCustomEvent(t,"OnAfterUrlConvert",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnAfterLinkInserted",this.OnAfterUrlConvert.bind(this));BX.addCustomEvent(t,"OnBeforeCommandExec",this.OnBeforeCommandExec.bind(this));t.contextMenu.items["postimage"]=t.contextMenu.items["postdocument"]=t.contextMenu.items["postfile"]=[{TEXT:BX.message("BXEdDelFromText"),bbMode:true,ACTION:function(){var e=t.contextMenu.GetTargetItem("postimage");if(!e)e=t.contextMenu.GetTargetItem("postdocument");if(!e)e=t.contextMenu.GetTargetItem("postfile");if(e&&e.element){t.selection.RemoveNode(e.element)}t.contextMenu.Hide()}}];if(!this.params["lazyLoad"]){BX.onCustomEvent(this.eventNode,"OnShowLHE",["justShow",t,false])}if(t.toolbar.controls&&t.toolbar.controls.FontSelector){t.toolbar.controls.FontSelector.SetWidth(45)}if(BX(this.formID)){BX.addCustomEvent(BX(this.formID),"onAutoSavePrepare",function(e){var i=e;setTimeout(function(){BX.addCustomEvent(t,"OnContentChanged",BX.proxy(function(e){this["mpfTextContent"]=e;this.Init()},i))},1500)});BX.addCustomEvent(BX(this.formID),"onAutoSave",BX.proxy(function(e,t){if(BX.type.isNotEmptyString(e["mpfTextContent"]))t["text"+this.formID]=e["mpfTextContent"]},this));BX.addCustomEvent(BX(this.formID),"onAutoSaveRestore",BX.proxy(function(i,n){if(e.handler[t.id]){for(var o in e.handler[t.id].controllers){if(e.handler[t.id].controllers.hasOwnProperty(o)&&e.handler[t.id].controllers[o].handler&&e.handler[t.id].controllers[o].handler.params&&e.handler[t.id].controllers[o].handler.params.controlName&&e.handler[t.id].controllers[o].handler.params.controlName){delete n[e.handler[t.id].controllers[o].handler.params.controlName]}}}if(n["text"+this.formID]&&/[^\s]+/gi.test(n["text"+this.formID])){t.CheckAndReInit(n["text"+this.formID])}},this));if(BX(this.formID).hasAttribute("bx-lhe-autosave-prepared")&&BX(this.formID).BXAUTOSAVE){BX(this.formID).removeAttribute("bx-lhe-autosave-prepared");setTimeout(BX.proxy(function(){BX(this.formID).BXAUTOSAVE.Prepare()},this),100)}}var i=this.formID,n=this.params;this.showPanelEditor(n.showPanelEditor,false);if(!t.mainPostFormCustomized){t.mainPostFormCustomized=true;BX.addCustomEvent(t,"OnIframeKeydown",function(e){if(window.onKeyDownHandler){window.onKeyDownHandler(e,t,i)}});BX.addCustomEvent(t,"OnIframeKeyup",function(e){if(window.onKeyUpHandler){window.onKeyUpHandler(e,t,i)}});if(window["BXfpdStopMent"+i]){BX.addCustomEvent(t,"OnIframeClick",function(){window["BXfpdStopMent"+i]()})}if(t&&t.textareaView.GetCursorPosition){BX.addCustomEvent(t,"OnTextareaKeyup",function(e){if(window.onTextareaKeyUpHandler){window.onTextareaKeyUpHandler(e,t,i)}});BX.addCustomEvent(t,"OnTextareaKeydown",function(e){if(window.onTextareaKeyDownHandler){window.onTextareaKeyDownHandler(e,t,i)}})}}},OnAfterUrlConvert:function(e){if(this.urlPreview){this.urlPreview.attachUrlPreview({url:e})}},OnBeforeCommandExec:function(e,t,i,n){if(this.urlPreview&&t=="createLink"&&BX.type.isPlainObject(n)&&n.hasOwnProperty("href")){this.urlPreview.attachUrlPreview({url:n.href})}}};s.getEditor=function(e){return window["BXHtmlEditor"]?window["BXHtmlEditor"].Get(typeof e=="object"?e.id:e):null};s.getHandler=function(t){return e.handler[typeof t=="object"?t.id:t]};s.getHandlerByFormId=function(t){return e.form[t]};s.unsetHandler=function(t){var i=typeof t=="object"?t.id:t;if(!e.handler[i])return;if(e.handler[i].oEditor)e.handler[i].oEditor.Destroy();e.handler[i]=null};s.reinitData=function(e,t,i){var n=s.getHandler(e);if(n)n.exec(n.reinit,[t,i]);return false};s.reinitDataBefore=function(e){var t=s.getHandler(e);if(t&&t["eventNode"])BX.onCustomEvent(t.eventNode,"onReinitializeBefore",[t])};window.LHEPostForm=s;window.BXPostFormTags=function(e,t){this.popup=null;this.formID=e;this.buttonID=t;this.sharpButton=null;this.addNewLink=null;this.tagsArea=null;this.hiddenField=null;this.popupContent=null;BX.ready(BX.proxy(this.init,this))};window.BXPostFormTags.prototype.init=function(){this.sharpButton=BX(this.buttonID);this.addNewLink=BX("post-tags-add-new-"+this.formID);this.tagsArea=BX("post-tags-block-"+this.formID);this.tagsContainer=BX("post-tags-container-"+this.formID);this.hiddenField=BX("post-tags-hidden-"+this.formID);this.popupContent=BX("post-tags-popup-content-"+this.formID);this.popupInput=BX.findChild(this.popupContent,{tag:"input"});var e=BX.findChildren(this.tagsContainer,{className:"feed-add-post-del-but"},true);for(var t=0,i=e.length;t<i;t++){BX.bind(e[t],"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:e[t].parentNode,tagValue:e[t].parentNode.getAttribute("data-tag")}))}BX.bind(this.sharpButton,"click",BX.proxy(this.onButtonClick,this));BX.bind(this.addNewLink,"click",BX.proxy(this.onAddNewClick,this))};window.BXPostFormTags.prototype.onTagDelete=function(){BX.remove(this.tagBox);this.obj.hiddenField.value=this.obj.hiddenField.value.replace(this.tagValue+",","").replace("  "," ")};window.BXPostFormTags.prototype.show=function(){if(this.popup===null){this.popup=new BX.PopupWindow("bx-post-tag-popup",this.addNewLink,{content:this.popupContent,lightShadow:false,offsetTop:8,offsetLeft:10,autoHide:true,angle:true,closeByEsc:true,zIndex:-840,buttons:[new BX.PopupWindowButton({text:BX.message("TAG_ADD"),events:{click:BX.proxy(this.onTagAdd,this)}})]});BX.bind(this.popupInput,"keydown",BX.proxy(this.onKeyPress,this));BX.bind(this.popupInput,"keyup",BX.proxy(this.onKeyPress,this))}this.popup.show();BX.focus(this.popupInput)};window.BXPostFormTags.prototype.addTag=function(e){var t=BX.type.isNotEmptyString(e)?e.split(","):this.popupInput.value.split(",");var i=[];for(var n=0;n<t.length;n++){var o=BX.util.trim(t[n]);if(o.length>0){var r=this.hiddenField.value.split(",");if(!BX.util.in_array(o,r)){var s;var a=BX.create("span",{children:[s=BX.create("span",{attrs:{class:"feed-add-post-del-but"}})],attrs:{class:"feed-add-post-tags"}});a.insertBefore(document.createTextNode(o),s);this.tagsContainer.insertBefore(a,this.addNewLink);BX.bind(s,"click",BX.proxy(this.onTagDelete,{obj:this,tagBox:a,tagValue:o}));this.hiddenField.value+=o+",";i.push(o)}}}return i};window.BXPostFormTags.prototype.onTagAdd=function(){this.addTag();this.popupInput.value="";this.popup.close()};window.BXPostFormTags.prototype.onAddNewClick=function(e){e=e||window.event;this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onButtonClick=function(e){e=e||window.event;BX.show(this.tagsArea);this.show();BX.PreventDefault(e)};window.BXPostFormTags.prototype.onKeyPress=function(e){e=e||window.event;var t=e.keyCode?e.keyCode:e.which?e.which:null;if(t==13){setTimeout(BX.proxy(this.onTagAdd,this),0)}};window.BXPostFormImportant=function(e,t,i){if(i){this.formID=e;this.buttonID=t;this.inputName=i;this.fireButton=null;this.activeBlock=null;this.hiddenField=null;BX.ready(BX.proxy(this.init,this))}return false};window.BXPostFormImportant.prototype.init=function(){this.fireButton=BX(this.buttonID);this.activeBlock=BX(this.buttonID+"-active");var e=BX(this.formID);if(e){this.hiddenField=e[this.inputName];if(this.hiddenField&&this.hiddenField.value==1){this.showActive()}}BX.bind(this.fireButton,"click",BX.proxy(function(e){e=e||window.event;this.showActive();BX.PreventDefault(e)},this));BX.bind(this.activeBlock,"click",BX.proxy(function(e){e=e||window.event;this.hideActive();BX.PreventDefault(e)},this))};window.BXPostFormImportant.prototype.showActive=function(e){BX.hide(this.fireButton);BX.show(this.activeBlock,"inline-block");if(this.hiddenField){this.hiddenField.value=1}return false};window.BXPostFormImportant.prototype.hideActive=function(e){BX.hide(this.activeBlock);BX.show(this.fireButton,"inline-block");if(this.hiddenField){this.hiddenField.value=0}return false};var a=null;window.MPFbuttonShowWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||this;e=e?e.tagName=="A"?e:e.parentNode:e;if(e){BX.addClass(e,"ui-btn-clock");a=e;BX.defer(function(){e.disabled=true})()}};window.MPFbuttonCloseWait=function(e){if(e&&!BX.type.isElementNode(e))e=null;e=e||a||this;if(e){e.disabled=false;BX.removeClass(e,"ui-btn-clock");a=null}};window.__mpf_wd_getinfofromnode=function(e,t){var i=BX.findChild(BX((e["prefixNode"]||"wd-doc")+e.element_id),{className:"files-preview",tagName:"IMG"},true,false);if(i){e.lowsrc=i.src;e.element_url=i.src.replace(/\Wwidth=(\d+)/,"").replace(/\Wheight\=(\d+)/,"");e.width=parseInt(i.getAttribute("data-bx-full-width"));e.height=parseInt(i.getAttribute("data-bx-full-height"))}else if(t.urlGet){e.element_url=t.urlGet.replace("#element_id#",e.element_id).replace("#ELEMENT_ID#",e.element_id).replace("#element_name#",e.element_name).replace("#ELEMENT_NAME#",e.element_name)}};var d={listen:false,plus:false,text:"",bSearch:false,node:null,mode:null};window.onKeyDownHandler=function(e,t,i){var n=e.keyCode;if(!window["BXfpdStopMent"+i])return true;var o=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(n===t.KEY_CODES["backspace"]&&d.node){var r=BX.util.trim(t.util.GetTextContent(d.node));if(r==="+"||r==="@"||d.mode=="button"&&r.length==1){window["BXfpdStopMent"+i]()}else if(d.mode=="button"&&r.length==1){window["BXfpdStopMent"+i]()}}if(BX.util.in_array(n,[107,187])||(e.shiftKey||e.modifiers>3)&&BX.util.in_array(n,[50,43,61])||e.altKey&&BX.util.in_array(n,[76])||typeof e.getModifierState==="function"&&!!e.getModifierState("AltGraph")&&BX.util.in_array(n,[81])){setTimeout(function(){var e=t.selection.GetRange(),i=t.GetIframeDoc(),n=e?e.endContainer.textContent:"",r=n?n.slice(e.endOffset-1,e.endOffset):"",s=n?n.slice(e.endOffset-2,e.endOffset-1):"";if((r=="@"||r=="+")&&(!s||BX.util.in_array(s,["+","@",",","("])||s.length==1&&BX.util.trim(s)==="")){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=true;d.mode="plus";e.setStart(e.endContainer,e.endOffset-1);e.setEnd(e.endContainer,e.endOffset);t.selection.SetSelection(e);d.node=BX.create("SPAN",{props:{id:"bx-mention-node"}},i);t.selection.Surround(d.node,e);e.setStart(d.node,1);e.setEnd(d.node,1);t.selection.SetSelection(e);if(BX.type.isNotEmptyString(o)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:o,bindPosition:l(d.node,t)}])}}},10)}if(d.listen){var s=null;if(BX.type.isNotEmptyString(o)){s=BX.UI.SelectorManager.instances[o]}var a=false;if(s){a=s.getNavigationInstance().checkKeyboardNavigation({keyCode:n,tab:d.bSearch?"search":s?s.tabs.selected:false})}if(a){t.iframeKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}}if(!d.listen&&d.listenFlag&&n===t.KEY_CODES["enter"]){var h=t.selection.GetRange();if(h.collapsed){var f=h.endContainer,u=t.GetIframeDoc();if(f){if(f.className!=="bxhtmled-metion"){f=BX.findParent(f,function(e){return e.className=="bxhtmled-metion"},u.body)}if(f&&f.className=="bxhtmled-metion"){t.selection.SetAfter(f)}}}}};window.onKeyUpHandler=function(e,t,i){var n=e.keyCode,o,r;if(!window["BXfpdStopMent"+i])return true;if(d.listen===true){if(n==t.KEY_CODES["escape"]){window["BXfpdStopMent"+i]()}else if(n!==t.KEY_CODES["enter"]&&n!==t.KEY_CODES["left"]&&n!==t.KEY_CODES["right"]&&n!==t.KEY_CODES["up"]&&n!==t.KEY_CODES["down"]){if(BX(d.node)){r=BX.util.trim(t.util.GetTextContent(d.node));var s=r;r=r.replace(/^[\+@]*/,"");d.bSearch=r.length>0;var a=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.type.isNotEmptyString(a)){var h=BX.UI.SelectorManager.instances[a];if(BX.type.isNotEmptyObject(h)){h.getSearchInstance().runSearch({text:r})}}if(d.leaveContent&&d._lastText&&s===""){window["BXfpdStopMent"+i]()}else if(d.leaveContent&&d.lastText&&s!==""&&r===""){d.bSearch=false;window["BXfpdStopMent"+i]();if(BX.type.isNotEmptyString(a)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:a,bindPosition:l(d.node,t)}])}}d.lastText=r;d._lastText=s}else{window["BXfpdStopMent"+i]()}}}else{if(!e.shiftKey&&(n===t.KEY_CODES["space"]||n===t.KEY_CODES["escape"]||n===188||n===190)){o=t.selection.GetRange();if(o.collapsed){var f=o.endContainer,u=t.GetIframeDoc();if(f){if(f.className!=="bxhtmled-metion"){f=BX.findParent(f,function(e){return e.className=="bxhtmled-metion"},u.body)}if(f&&f.className=="bxhtmled-metion"){r=t.util.GetTextContent(f);var c=r.match(/[\s\.\,]$/);if(c||n===t.KEY_CODES["escape"]){f.innerHTML=r.replace(/[\s\.\,]$/,"");var p=BX.create("SPAN",{html:c||t.INVISIBLE_SPACE},u);t.util.InsertAfter(p,f);t.selection.SetAfter(p)}}}}}}};window.onTextareaKeyDownHandler=function(e,t,i){var n=e.keyCode;if(d.listen&&n==t.KEY_CODES["enter"]){var o=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(BX.type.isNotEmptyString(o)){var r=BX.UI.SelectorManager.instances[o];if(BX.type.isNotEmptyObject(r)){r.getNavigationInstance().selectFirstItem({tab:d.bSearch?"search":r.tabs.selected})}}t.textareaKeyDownPreventDefault=true;e.stopPropagation();e.preventDefault()}};window.onTextareaKeyUpHandler=function(e,t,i){var n,o,r=e.keyCode;var s=window.MPFgetSelectorId("bx-mention-"+i+"-id");if(d.listen===true){if(r==27){window["BXfpdStopMent"+i]()}else if(r!==13){o=t.textareaView.GetValue(false);n=t.textareaView.GetCursorPosition();if(o.indexOf("+")!==-1||o.indexOf("@")!==-1){var a=o.substr(0,n),l=Math.max(a.lastIndexOf("+"),a.lastIndexOf("@"));if(l>=0){var h=a.substr(l),f=h;h=h.replace(/^[\+@]*/,"");d.bSearch=h.length>0;var u=null;if(BX.type.isNotEmptyString(s)){u=BX.UI.SelectorManager.instances[s]}if(BX.type.isNotEmptyObject(u)){u.getSearchInstance().runSearch({text:h})}if(d.leaveContent&&d._lastText&&(f===""||h==="")){window["BXfpdStopMent"+i]()}d.lastText=h;d._lastText=f}}}}else{if(r==16){var c=this;this.shiftPressed=true;if(this.shiftTimeout)this.shiftTimeout=clearTimeout(this.shiftTimeout);this.shiftTimeout=setTimeout(function(){c.shiftPressed=false},100)}if(r==107||(e.shiftKey||e.modifiers>3||this.shiftPressed)&&BX.util.in_array(r,[187,50,107,43,61])){n=t.textareaView.element.selectionStart;if(n>0){o=t.textareaView.element.value;var p=o.substr(n-1,1);if(p&&(p==="+"||p==="@")){d.listen=true;d.listenFlag=true;d.text="";d.textarea=true;d.bSearch=false;d.mode="plus";if(BX.type.isNotEmptyString(s)){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:s}])}}}}}};var l=function(e,t){var i=BX.pos(e),n=BX.pos(t.dom.areaCont),o=BX.GetWindowScrollPos(t.GetIframeDoc()),r=n.top+i.bottom-o.scrollTop+2,s=n.left+i.right-o.scrollLeft;return{top:r,left:s}};window.BxInsertMention=function(e){var t=e.item,i=e.type,n=e.formID,o=e.editorId,r=e.bNeedComa,a=s.getEditor(o),l;if(i=="users"&&t&&t.entityId>0&&a){if(a.GetViewMode()=="wysiwyg"){var h=a.GetIframeDoc(),f=a.selection.GetRange(),u=BX.create("SPAN",{props:{className:"bxhtmled-metion"},text:BX.util.htmlspecialcharsback(t.name)},h);l=BX.create("SPAN",{html:r?",&nbsp;":"&nbsp;"},h);a.SetBxTag(u,{tag:"postuser",params:{value:t.entityId}});if(BX(d.node)&&d.node.parentNode){a.util.ReplaceNode(d.node,u)}else{a.selection.InsertNode(u,f)}if(u&&u.parentNode){var c=BX.findParent(u,{className:"bxhtmled-metion"},h.body);if(c){a.util.InsertAfter(u,c)}}if(u&&u.parentNode){a.util.InsertAfter(l,u);a.selection.SetAfter(l)}}else if(a.GetViewMode()=="code"&&a.bbCode){a.textareaView.Focus();var p=a.textareaView.GetValue(false),m=a.textareaView.GetCursorPosition(),v=p.substr(0,m),B=Math.max(v.lastIndexOf("+"),v.lastIndexOf("@"));if(B>=0&&m>B){a.textareaView.SetValue(p.substr(0,B)+p.substr(m));a.textareaView.element.setSelectionRange(B,B)}a.textareaView.WrapWith(false,false,"[USER="+t.entityId+"]"+t.name+"[/USER]"+(r?", ":" "))}if(e.fireAddEvent===true){BX.onCustomEvent(window,"onMentionAdd",[t])}var g=window.MPFgetSelectorId("bx-mention-"+n+"-id");if(BX.type.isNotEmptyString(g)){var X=BX.UI.SelectorManager.instances[g];if(BX.type.isNotEmptyObject(X)){if(typeof X.itemsSelected[t.id]!="undefined"){delete X.itemsSelected[t.id]}}}window["BXfpdStopMent"+n]();d["text"]="";if(a.GetViewMode()=="wysiwyg"){a.Focus();a.selection.SetAfter(l)}}};window.MPFgetSelectorId=function(e){var t=false;var i=BX(e);if(!i){return t}t=i.getAttribute("data-bx-selector-id");return t};window.MPFMentionInit=function(e,t){if(t.initDestination===true){BX.addCustomEvent("onAutoSaveRestoreDestination",function(t){if(BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t.data)&&BX.type.isNotEmptyObject(t.data["DEST_CODES[]"])&&BX.type.isNotEmptyString(t.formId)&&t.formId==e&&BX.UI.SelectorManager){var i=window.MPFgetSelectorId(t.formId);var n=BX.UI.SelectorManager.instances[i];if(!BX.type.isNotEmptyObject(n)){return}var o=null,r=null,s={},a=[],d=false;for(var l=0;l<t.data["DEST_CODES[]"].length;l++){o=t.data["DEST_CODES[]"][l];if(o=="UA"){s[o]="groups"}d=o.match(/^U(\d+)$/i);if(d){s[o]="users";continue}d=o.match(/^SG(\d+)$/i);if(d){s[o]="sonetgroups";continue}d=o.match(/^DR(\d+)$/i);if(d){s[o]="departments";continue}d=o.match(/^UE(.+)$/i);if(d&&BX.SocialnetworkUISelector){r=d[1];a.push({selectorId:i,name:BX.type.isNotEmptyString(t.data["INVITED_USER_NAME["+r+"]"])?t.data["INVITED_USER_NAME["+r+"]"]:"",lastName:BX.type.isNotEmptyString(t.data["INVITED_USER_LAST_NAME["+r+"]"])?t.data["INVITED_USER_LAST_NAME["+r+"]"]:"",email:r,createCrmContact:BX.type.isNotEmptyString(t.data["INVITED_USER_CREATE_CRM_CONTACT["+r+"]"])?t.data["INVITED_USER_CREATE_CRM_CONTACT["+r+"]"]:""})}}n.itemsSelected=s;BX.addCustomEvent(window,"BX.Main.SelectorV2:afterInitDialog",function(e){if(e.id==i&&BX.SocialnetworkUISelector){for(var t=0;t<a.length;t++){BX.SocialnetworkUISelector.inviteEmailAddUser(a[t])}}})}});BX.addCustomEvent(window,"onMentionAdd",function(t){var i=window.MPFgetSelectorId(e);var n=BX.UI.SelectorManager.instances[i];if(!BX.type.isNotEmptyObject(n)){return}var o=BX.Main.selectorManagerV2.getById(n.id);if(BX.type.isNotEmptyObject(o)&&BX.type.isBoolean(o.initialized)){if(o.initialized){if(!BX.type.isNotEmptyObject(n.entities.USERS.items[t.id])){n.entities.USERS.items[t.id]=t}n.setOption("focusInputOnSelectItem","N");if(!BX.type.isNotEmptyString(n.itemsSelected[t.id])){n.selectItem({itemId:t.id,entityType:"USERS"})}}else{n.itemsSelected[t.id]="users";o.initDialog()}}})}window["BXfpdSelectCallbackMent"+e]=function(i){window.BxInsertMention({item:i.item,type:i.entityType.toLowerCase(),formID:e,editorId:t.editorId,fireAddEvent:t.initDestination})};window["BXfpdStopMent"+e]=function(){var t=window.MPFgetSelectorId("bx-mention-"+e+"-id");if(BX.type.isNotEmptyString(t)){var i=BX.UI.SelectorManager.instances[t];if(BX.type.isNotEmptyObject(i)){i.closeAllPopups();i.getSearchInstance().abortSearchRequest()}}};BX.ready(function(){var i=BX("bx-b-mention-"+e);var n=window.MPFgetSelectorId("bx-mention-"+e+"-id");if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:init",[{id:n,openDialogWhenInit:false}])}BX.bind(i,"click",function(e){if(d.listen!==true){var o=s.getEditor(t.editorId),r=o.GetIframeDoc();if(o.GetViewMode()=="wysiwyg"&&r){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;d.mode="button";var a=o.selection.GetRange();if(BX(d.node)){BX.remove(BX(d.node))}o.InsertHtml('<span id="bx-mention-node">'+o.INVISIBLE_SPACE+"</span>",a);setTimeout(function(){if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:n,bindNode:i}])}d.node=r.getElementById("bx-mention-node");if(d.node){a.setStart(d.node,0);if(d.node.firstChild&&d.node.firstChild.nodeType==3&&d.node.firstChild.nodeValue.length>0){a.setEnd(d.node,1)}else{a.setEnd(d.node,0)}o.selection.SetSelection(a)}o.Focus()},100)}else if(o.GetViewMode()=="code"){d.listen=true;d.listenFlag=true;d.text="";d.leaveContent=false;d.mode="button";setTimeout(function(){if(n){BX.onCustomEvent(window,"BX.MPF.MentionSelector:open",[{id:n,bindNode:i}])}},100)}BX.onCustomEvent(i,"mentionClick")}})})};window.BXfpdOnDialogOpen=function(){d.listen=true;d.listenFlag=true};window.BXfpdOnDialogClose=function(e){d.listen=false;setTimeout(function(){d.listenFlag=false;if(!d.listen){var t=s.getEditor(e.editorId);if(t){var i=t.GetIframeDoc();if(BX(d.node)){t.selection.SetAfter(d.node);if(d.leaveContent){t.util.ReplaceWithOwnChildren(d.node)}else{BX.remove(BX(d.node))}}t.Focus()}}},100)}})();
/* End */
;; /* /local/templates/shop/components/bitrix/catalog.element/detail/script.min.js?159681840358488*/
; /* /local/templates/shop/components/bitrix/forum.topic.reviews/Forum_comment/script.min.js?159706558816915*/
; /* /bitrix/components/bitrix/main.post.form/templates/.default/script.min.js?159569178660303*/

//# sourceMappingURL=page_6e5077a2fca2996efb79636f46dee66f.map.js